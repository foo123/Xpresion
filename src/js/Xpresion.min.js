/**
*
*   Xpresion
*   Simple eXpression parser engine with variables and custom functions support for PHP, Python, Node/JS, ActionScript
*   @version: 0.6.1
*
*   https://github.com/foo123/Xpresion
*
**/
!function(t,n,e){"use strict";var r,i="object"==typeof module&&module.exports,u="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[n]=module.$deps[n]||e.call(t,{NODE:module})||1:u&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(n,r,i){return e.call(t,{AMD:i})}):n in t||(t[n]=r=e.call(t,{})||1)&&u&&define(n,[],function(){return r})}(this,"Xpresion",function(t,n){"use strict";var e,r,i,u,o,l,a,s,c="0.6.1",f="prototype",p="hasOwnProperty",h=Object[f].toString,d=JSON.stringify,_=Object.keys,y=Object.create,g=Math.abs,m=Math.max,v=function(t,n){return new Function(t,n)},$=function(t,n){return new RegExp(t,n||"")},b=/\n\r|\r\n|\n|\r/g,T=/'/g,O=function(){return null},R=function(t,n,e){var r=v("Fn,Cache",["return function evaluator(Var){",'    "use strict";',"    return "+t+";","};"].join("\n"))(n,e);return r},E=function(t){return t instanceof String||"[object String]"===h.call(t)},D=function(t,n,e,r){e=e||" ";var i=t.toString(),u=i.length,o=u>=n?"":new Array(1+n-u>>>0).join(e);return r?t+o:o+t},P=/\\?([a-z])/gi,F={d:function(t){return D(t.getDate(),2,"0")},D:function(t,n){return n.days_abr[t.getDay()]},j:function(t){return t.getDate()},l:function(t,n){return n.days[t.getDay()]},N:function(t){return t.getDay()||7},S:function(t,n){var e=t.getDate();return 4>e||e>20&&(n.ordinal[e%10-1]||n.ordinal[3])},w:function(t){return t.getDay()},z:function(t,n){var e=new Date(F.Y(t,n),t.getMonth(),t.getDate()),r=new Date(F.Y(t,n),0,1);return round((e-r)/864e5)},W:function(t,n){var e=new Date(F.Y(t,n),t.getMonth(),t.getDate()-F.N(t,n)+3),r=new Date(e.getFullYear(),0,4);return D(1+round((e-r)/864e5/7),2,"0")},F:function(t,n){return n.months[t.getMonth()]},m:function(t){return D(t.getMonth()+1,2,"0")},M:function(t,n){return n.months_abr[t.getMonth()]},n:function(t){return t.getMonth()+1},t:function(t,n){return new Date(F.Y(t,n),t.getMonth()+1,0).getDate()},L:function(t,n){var e=F.Y(t,n);return e%4===0&e%100!==0|e%400===0},o:function(t,n){var e=t.getMonth()+1,r=F.W(t,n),i=F.Y(t,n);return i+(12===e&&9>r?1:1===e&&r>9?-1:0)},Y:function(t){return t.getFullYear()},y:function(t,n){return F.Y(t,n).toString().slice(-2)},a:function(t,n){return t.getHours()>11?n.meridian.pm:n.meridian.am},A:function(t,n){return F.a(t,n).toUpperCase()},B:function(t){var n=3600*t.getUTCHours(),e=60*t.getUTCMinutes(),r=t.getUTCSeconds();return D(floor((n+e+r+3600)/86.4)%1e3,3,"0")},g:function(t,n){return F.G(t,n)%12||12},G:function(t){return t.getHours()},h:function(t,n){return D(F.g(t,n),2,"0")},H:function(t,n){return D(F.G(t,n),2,"0")},i:function(t){return D(t.getMinutes(),2,"0")},s:function(t){return D(t.getSeconds(),2,"0")},u:function(t){return D(1e3*t.getMilliseconds(),6,"0")},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(t,n){var e=new Date(F.Y(t,n),0),r=Date.UTC(F.Y(t,n),0),i=new Date(F.Y(t,n),6),u=Date.UTC(F.Y(t,n),6);return e-r!==i-u?1:0},O:function(t){var n=t.getTimezoneOffset(),e=abs(n);return(n>0?"-":"+")+D(100*floor(e/60)+e%60,4,"0")},P:function(t,n){var e=F.O(t,n);return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(t){return 60*-t.getTimezoneOffset()},c:function(t,n,e){return"Y-m-d\\TH:i:sP".replace(P,e)},r:function(t,n,e){return"D, d M Y H:i:s O".replace(P,e)},U:function(t){return t/1e3|0}},S={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridian:{pm:"pm",am:"am"},ordinal:["1st","2nd","3rd","nth"]},x=function(t,n,e){return function r(i,u){return t[p](i)?t[i](e,n,r):u}},M=function(){return Math.floor((new Date).getTime()/1e3)},N=function(t,n){var e=void 0===n?new Date:new Date(n instanceof Date?n:1e3*n);return t.replace(P,x(F,S,e))},A="BLOCKS",w="OPERATORS",C="FUNCTIONS",Y=!1,j=!1;a=function ln(t){var n=this;return n instanceof ln?(n.source=t||"",n.setup(),void ln.parse(n)):new ln(t)},a.VERSION=c;var I=(a.COMMA=",",a.LPAREN="(",a.RPAREN=")",a.NONE=0),U=a.DEFAULT=1,z=a.LEFT=-2,k=a.RIGHT=2,L=a.PREFIX=2,V=a.INFIX=4,K=a.POSTFIX=8,X=a.T_DUM=0,q=a.T_DFT=1,B=a.T_IDE=16,H=a.T_VAR=17,J=a.T_LIT=32,Z=a.T_NUM=33,G=a.T_STR=34,W=a.T_REX=35,Q=a.T_BOL=36,tn=(a.T_DTM=37,a.T_ARY=38),nn=a.T_OP=128,en=a.T_N_OP=129,rn=a.T_POLY_OP=130,un=a.T_FUN=131,on=a.T_EMPTY=1024;return a.Tpl=e=function an(t,n,e){var r=this;return r instanceof an?(r.id=null,r._renderer=null,r.tpl=n instanceof RegExp?an.multisplit_re(t||"",n):an.multisplit(t||"",n||an.defaultArgs),!0===e&&(r._renderer=an.compile(r.tpl)),void r.fixRenderer()):new an(t,n,e)},e.defaultArgs={"$-5":-5,"$-4":-4,"$-3":-3,"$-2":-2,"$-1":-1,$0:0,$1:1,$2:2,$3:3,$4:4,$5:5},e.multisplit=function(t,n,e){var r,i,u,o,l,a,s,c,f,p;e=!!e,a=[[1,t]];for(r in n)if(n.hasOwnProperty(r)){for(c=[],i=e?n[r]:r,u=[0,n[r]],o=0,f=a.length;f>o;o++)if(1===a[o][0]){if(s=a[o][1].split(i),p=s.length,c.push([1,s[0]]),p>1)for(l=0;p-1>l;l++)c.push(u),c.push([1,s[l+1]])}else c.push(a[o]);a=c}return a},e.multisplit_re=function(t,n){for(var e,r=[],i=0;e=n.exec(t);)r.push([1,t.slice(i,n.lastIndex-e[0].length)]),r.push([0,e[1]?e[1]:e[0]]),i=n.lastIndex;return r.push([1,t.slice(i)]),r},e.arg=function(t,n){var e,r,i,u,o,l="args";if(arguments.length&&null!=t)for(t=t.substr?t.length?t.split("."):[]:[t],u=t.length,o=!(!n||!n.substr),e=0;u>e;e++)r=t[e],i=+r,isNaN(i)?l+='["'+r+'"]':(0>i&&(r=o?n+-i:l+".length-"+-i),l+="["+r+"]");return l},e.compile=function(t,n){var r,i,u,o,l=t.length;if(!0===n){for(o='"use strict"; return (',r=0;l>r;r++)i=t[r][0],u=t[r][1],o+=i?u:e.arg(u);o+=");"}else{for(o='"use strict"; var argslen=args.length; return (',r=0;l>r;r++)i=t[r][0],u=t[r][1],o+=i?"'"+u.replace(T,"\\'").replace(b,"' + \"\\n\" + '")+"'":" + String("+e.arg(u,"argslen")+") + ";o+=");"}return v("args",o)},e[f]={constructor:e,id:null,tpl:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[f].render,this},render:function(t){t=t||[];var n,e,r,i=this.tpl,u=i.length,o=t.length,l="";for(n=0;u>n;n++)e=i[n][0],r=i[n][1],l+=e?r:!r.substr&&0>r?t[o+r]:t[r];return l}},a.Alias=i=function sn(t){return this instanceof sn?void(this.alias=t):new sn(t)},i.get_entry=function(t,n){if(n&&t&&t[p](n)){for(var e=t[n];e instanceof i&&t[p](e.alias);){if(n=e.alias,e===t[n])return!1;e=t[n]}return e}return!1},a.Node=r=function cn(t,n,e,r,i){var u=this;return u instanceof cn?(u.type=t,u.arity=n,u.node=e,u.children=r||null,void(u.pos=i||0)):new cn(t,n,e,r,i)},r[f]={constructor:r,type:null,arity:null,node:null,children:null,pos:null,op_parts:null,op_def:null,op_index:null,op_next:function(t,n,e,r){var i=this,u=0,l=0===i.op_parts.indexOf(t.input);return l&&0===i.op_def[0][0]&&(u=o.match_args(i.op_def[0][2],n-1,e,r),!1===u?l=!1:(i.arity=u,i.op_def.shift())),l&&(i.op_def.shift(),i.op_parts.shift()),l},op_complete:function(){return!this.op_parts.length},dispose:function(){var t,n,e=this,r=e.children;if(r&&(t=r.length))for(n=0;t>n;n++)r[n]&&r[n].dispose();return e.type=null,e.arity=null,e.pos=null,e.node=null,e.op_parts=null,e.op_def=null,e.op_index=null,r=e.children=null,e},toString:function(){var t,n=[],e=this.node,r=this.children?this.children:[],i=r.length,u=arguments.length&&arguments[0].substr?arguments[0]:"",o=u+"  ";for(t=0;i>t;t++)n.push(r[t].toString(o));return u+["Node("+e.type+","+e.arity+"): "+(e.parts?e.parts.join(" "):e.input),"Childs: [",u+n.join("\n"+u),"]"].join("\n"+u)+"\n"}},r.DFT=function(t,n,e){e=!1!==e,n=n||a.render;for(var r,i,u,o,l=[t],s=[];l.length;)r=l[0],r.children&&r.children.length?(l=r.children.concat(l),r.children=null):(l.shift(),i=r.node,u=i.arity,nn&i.type&&0===u?u=1:u>s.length&&i.arity_min<=i.arity&&(u=i.arity_min),o=n(i,u?s.splice(s.length-u,u):[]),s.push(o),e&&r.dispose());return l=null,s[0]},a.reduce=function(t,n,e,i,u,o){var l,a,c,f,p,h,d,_=null,y=0;if(i)if(f=i,rn===f.type&&(f=f.morph([u,t,n])),en===f.type){if(h=f.validate(u,n,t),!1===h[0])return o.err=!0,o.msg=h[1],!1;c=f.node(null,u,n,t),c.arity=h[0],e.unshift(c),n.unshift(c)}else{if(e.length&&(_=e[0],y=_.op_index),_&&_.op_next(f,u,n,t)){for(;n.length>y;)l=n.shift(),a=l.node,d=a.arity,nn&a.type&&0===d?d=1:d>t.length&&a.arity_min<=a.arity&&(d=a.arity_min),c=a.node(d?t.splice(t.length-d,d):[],l.pos),t.push(c);if(!_.op_complete())return;e.shift(),n.shift(),f=_.node,_.dispose(),y=e.length?e[0].op_index:0}else if(h=f.validate(u,n,t),!1===h[0])return o.err=!0,o.msg=h[1],!1;if(p=f.fixity,K===p)(d=f.arity)>t.length&&f.arity_min<=t.length&&(d=f.arity_min),c=f.node(d?t.splice(t.length-d,d):[],u),t.push(c);else if(L===p)n.unshift(r(f.otype,f.arity,f,null,u)),nn&f.type&&0===f.arity&&t.push(s.node(null,u+1));else{for(;n.length>y;){if(l=n.shift(),a=l.node,!(a.priority<f.priority||a.priority===f.priority&&(a.associativity<f.associativity||a.associativity===f.associativity&&a.associativity<0))){n.unshift(l);break}d=a.arity,nn&a.type&&0===d?d=1:d>t.length&&a.arity_min<=a.arity&&(d=a.arity_min),c=a.node(d?t.splice(t.length-d,d):[],l.pos),t.push(c)}n.unshift(r(f.otype,f.arity,f,null,u))}}else for(;n.length;)l=n.shift(),a=l.node,d=a.arity,nn&a.type&&0===d?d=1:d>t.length&&a.arity_min<=a.arity&&(d=a.arity_min),c=a.node(d?t.splice(t.length-d,d):[],l.pos),t.push(c)},a.parse_delimited_block=function(t,n,e,r,i){var u=r,o=!1,l="";for(i=!1!==i,n+=1;e>n&&(l=t.charAt(n++),u+=l,r!==l||o);)o=i?!o&&"\\"===l:!1;return u},a.parse=function(t){var n,e,r,u,o,l,s,c,f,h,d,y,g,m,v,$,b=a.reduce,T=i.get_entry,O=t.RE,R=t[A],E=!O[p]("t_var"),D=0,P={err:!1,msg:""};for(n=t.source,e=n.length,t._cnt=0,t._symbol_table={},t._cache={},t.variables={},f=[],h=[],d=[],y=0,l=0,D=0;e>l;)if(u=n.charAt(l),(g=T(R,u))&&(o=g.parse(n,l,e,u),!1!==o&&(l+=o.length,m=g[p]("rest")?g.rest(n,l,e)||"":"",l+=m.length,c=t.t_block(o,g.type,m),!1!==c)))y+=1,f.push(c.node(null,y));else if(r=n.slice(l),s=r.match(O.t_spc))l+=s[0].length;else if((s=r.match(O.t_num))&&(c=t.t_liter(s[1],Z),!1!==c))y+=1,f.push(c.node(null,y)),l+=s[0].length;else{if(s=r.match(O.t_ident)){if(c=t.t_liter(s[1],B),!1!==c){y+=1,f.push(c.node(null,y)),l+=s[0].length;continue}if(c=t.t_op(s[1]),!1!==c){if(y+=1,b(f,h,d,c,y,P),P.err){D=1,$=P.msg;break}l+=s[0].length;continue}if(E&&(c=t.t_var(s[1]),!1!==c)){y+=1,f.push(c.node(null,y)),l+=s[0].length;continue}}if(s=r.match(O.t_special)){for(o=s[1],c=!1;o.length>0&&(c=t.t_op(o),!1===c);)o=o.slice(0,-1);if(!1!==c){if(y+=1,b(f,h,d,c,y,P),P.err){D=1,$=P.msg;break}l+=o.length;continue}}if(E||!(s=r.match(O.t_var))||(c=t.t_var(s[1]),!1===c)){if(s=r.match(O.t_nonspc)){if(c=t.t_liter(s[1],J),!1!==c){y+=1,f.push(c.node(null,y)),l+=s[0].length;continue}if(c=t.t_op(s[1]),!1!==c){if(y+=1,b(f,h,d,c,y,P),P.err){D=1,$=P.msg;break}l+=s[0].length;continue}c=t.t_tok(s[1]),y+=1,f.push(c.node(null,y)),l+=s[0].length}}else y+=1,f.push(c.node(null,y)),l+=s[0].length}if(D||(b(f,h,d),(1!==f.length||h.length>0)&&(D=1,$="Parse Error, Mismatched Parentheses or Operators")),!D)try{v=t.compile(f[0])}catch(r){D=1,$="Compilation Error, "+r.message}return d=null,h=null,f=null,t._symbol_table=null,D?(v=null,t.variables=[],t._cnt=0,t._cache={},t._evaluator_str="",t._evaluator=t.dummy_evaluator,console.error("Xpresion Error: "+$+" at "+n)):(t.variables=_(t.variables),t._evaluator_str=v[0],t._evaluator=v[1]),t},a.render=function(t,n){return t.render(n)},a.defRE=function(t,n){if("object"==typeof t){n=n||a.RE;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.defBlock=function(t,n){if("object"==typeof t){n=n||a[A];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.defReserved=function(t,n){if("object"==typeof t){n=n||a.Reserved;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.defOp=function(t,n){if("object"==typeof t){n=n||a[w];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.defFunc=function(t,n){if("object"==typeof t){n=n||a[C];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.defRuntimeFunc=function(t,n){if("object"==typeof t){n=n||a.Fn;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},a.Tok=u=function fn(t,n,e,r){var i=this;return i instanceof fn?(i.type=t,i.input=n,i.output=e,i.value=r||null,i.priority=1e3,i.parity=0,i.arity=0,i.arity_min=0,i.arity_max=0,i.associativity=U,i.fixity=V,i.parenthesize=!1,void(i.revert=!1)):new fn(t,n,e,r)},u.render=function(t,n){return t instanceof u?t.render(n):String(t)},u[f]={constructor:u,type:null,input:null,output:null,value:null,priority:1e3,parity:0,arity:0,arity_min:0,arity_max:0,associativity:U,fixity:V,parenthesize:!1,revert:!1,dispose:function(){var t=this;return t.type=null,t.input=null,t.output=null,t.value=null,t.priority=null,t.parity=null,t.arity=null,t.arity_min=null,t.arity_max=null,t.associativity=null,t.fixity=null,t.parenthesize=null,t.revert=null,t},setType:function(t){return this.type=t,this},setParenthesize:function(t){return this.parenthesize=!!t,this},setReverse:function(t){return this.revert=!!t,this},render:function(t){var n,r=this,i=r.output,u=r.parenthesize,o=u?a.LPAREN:"",l=u?a.RPAREN:"";return t||(t=[]),t.unshift(r.input),n=i instanceof e?i.render(t):i,o+n+l},evaluate:function(){return null},node:function(t,n){return r(this.type,this.arity,this,t?t:null,n)},toString:function(){return String(this.output)}},s=a.EMPTY_TOKEN=u(on,"",""),a.Op=o=function pn(t,r,i,o,l,a,s){var c=this;if(!(c instanceof pn))return new pn(t,r,i,o,l,a,s);t=t||"",l=l||"";var f=pn.parse_definition(t);c.type=f[0],c.opdef=f[1],c.parts=f[2],!l||l instanceof e||(l=e(l)),u.call(c,c.type,c.parts[0],l),c.fixity=r||L,c.associativity=i||U,c.priority=o||1e3,c.arity=f[3],c.arity_min=f[4],c.arity_max=f[5],c.otype=n!==a?a:q,c.ofixity=n!==s?s:c.fixity,c.parenthesize=!1,c.revert=!1,c.morphes=null},o.Condition=function(t){return["function"==typeof t[0]?t[0]:e.compile(e.multisplit(t[0],{"${POS}":0,"${TOKS}":1,"${OPS}":2,"${TOK}":3,"${OP}":4,"${PREV_IS_OP}":5,"${DEDUCED_TYPE}":6,Xpresion:7}),!0),t[1]]},o.parse_definition=function(t){var n,e,r,i=[],u=[],o=0,l=0,a=0;for(t=E(t)?[1,t,1]:[].concat(t),r=0;r<t.length;r++)E(t[r])?(i.push(t[r]),u.push([1,r,t[r]])):(u.push([0,r,t[r]]),n=g(t[r]),o+=n,a+=n,l+=t[r]);return 1===i.length&&1===u.length?(u=[[0,0,1],[1,1,i[0]],[0,2,1]],l=a=o=2,e=nn):e=i.length>1?en:nn,[e,u,i,o,m(0,l),a]},o.match_args=function(t,n,e,r){for(var i,u=r.length,o=u-1,l=0,a=g(t),s=-10;(a>l||o>=0)&&(i=o>=0?r[o].pos:s,n===i);)l++,n--,o--;return l>=a?a:0>=t?0:!1},o[f]=y(u[f]),o[f].otype=null,o[f].ofixity=null,o[f].opdef=null,o[f].parts=null,o[f].morphes=null,o[f].dispose=function(){var t=this;return u[f].dispose.call(t),t.otype=null,t.ofixity=null,t.opdef=null,t.parts=null,t.morphes=null,t},o[f].Polymorphic=function(t){var n=this;return n.type=rn,n.morphes=(t||[]).map(o.Condition),n},o[f].morph=function(t){var n,e=this.morphes,r=e.length,i=0,u=e[0][1],o=!1;for(t.length<8&&(t.push(t[1].length?t[1][t[1].length-1]:!1),t.push(t[2].length?t[2][0]:!1),t.push(t[4]?t[4].pos+1===t[0]:!1),t.push(t[4]?t[4].type:t[3]?t[3].type:0),t.push(a));r>i;){if(n=e[i++],!0===Boolean(n[0](t))){n=n[1],o=!0;break}n[1].priority>=u.priority&&(u=n[1])}for(o||(n=u);rn===n.type;)n=n.morph(t);return n},o[f].render=function(t){t&&t.length||(t=["",""]);{var n,r=this,i=r.otype,o=r.output,l=r.parenthesize,s=l?a.LPAREN:"",c=l?a.RPAREN:"",f=a.COMMA,p=r.ofixity;t.length}return n=o instanceof e?s+o.render(t)+c:V===p?s+t.join(o)+c:K===p?s+t.join(f)+c+o:o+s+t.join(f)+c,u(i,n,n)},o[f].validate=function(t,n,e){var r=this,i=r.opdef,u="",l=0;return 0===i[0][0]&&(l=o.match_args(i[0][2],t-1,n,e),!1===l&&(u='Operator "'+r.input+'" expecting '+i[0][2]+" prior argument(s)")),[l,u]},o[f].node=function(t,n){t=t||[];var e,i=this,u=i.otype;return i.revert&&t.reverse(),X===u&&t.length?u=t[0].type:t.length&&(t[0].type=u),e=new r(u,i.arity,i,t,n),en===i.type&&arguments.length>2&&(e.op_parts=i.parts.slice(1),e.op_def=i.opdef.slice(0===i.opdef[0][0]?2:1),e.op_index=arguments[2].length+1),e},a.Func=l=function hn(t,e,r,i,u,l,a){var s=this;return s instanceof hn?(o.call(s,E(t)?[t,n!==u?u:1]:t,L,l||k,i||1,e,r,a||L),void(s.type=un)):new hn(t,e,r,i,u,l,a)},l[f]=y(o[f]),a[f]={constructor:a,source:null,variables:null,RE:null,Reserved:null,BLOCKS:null,OPERATORS:null,FUNCTIONS:null,Fn:null,_cnt:0,_cache:null,_symbol_table:null,_evaluator_str:null,_evaluator:null,dummy_evaluator:null,dispose:function(){var t=this;return t.RE=null,t.Reserved=null,t[A]=null,t[w]=null,t[C]=null,t.Fn=null,t.dummy_evaluator=null,t.source=null,t.variables=null,t._cnt=null,t._symbol_table=null,t._cache=null,t._evaluator_str=null,t._evaluator=null,t},setup:function(){var t=this;return t.RE=a.RE,t.Reserved=a.Reserved,t[A]=a[A],t[w]=a[w],t[C]=a[C],t.Fn=a.Fn,t.dummy_evaluator=O,t},compile:function(t){var n=r.DFT(t,a.render,!0);return[n,R(n,this.Fn,this._cache)]},evaluator:function(t){return arguments.length?(t&&t.call&&(this._evaluator=t),this):this._evaluator},evaluate:function(t){return 1>arguments.length&&(t={}),this._evaluator(t)},debug:function(t){var n=this,e=["Expression: "+n.source,"Variables : ["+n.variables.join(",")+"]","Evaluator : "+n._evaluator_str];return arguments.length&&(e.push("Data      : "+d(t,null,4)),e.push("Result    : "+d(n.evaluate(t)))),e.join("\n")},toString:function(){return"[Xpresion source]: "+this.source},t_liter:function(t,n){return Z===n?u(Z,t,t):i.get_entry(this.Reserved,t.toLowerCase())},t_block:function(t,n,e){if(G===n)return u(G,t,t);if(W===n){e=e||"";var r,i,o="re_"+t+e;return this._symbol_table[p](o)?r=this._symbol_table[o]:(r="re_"+ ++this._cnt,i=t.slice(1,-1),this._cache[r]=$(i,e),this._symbol_table[o]=r),u(W,t,"Cache."+r)}return!1},t_var:function(t){return this.variables[p](t)||(this.variables[t]=t),u(H,t,'Var["'+t.split(".").join('"]["')+'"]')},t_op:function(t){var n=!1;return n=i.get_entry(this[C],t),!1===n&&(n=i.get_entry(this[w],t)),n},t_tok:function(t){return u(q,t,t)}},a.init=function(t){Y||(a[w]={},a[C]={},a.Fn={},a.RE={},a[A]={},a.Reserved={},a.defRuntimeFunc({INF:1/0,NAN:0/0,clamp:function(t,n,e){return n>e?t>n?n:e>t?e:t:t>e?e:n>t?n:t},len:function(t){return t?t.substr||t.push?t.length:Object===t.constructor?_(t).length:1:0},sum:function(){var t,n,e=arguments,r=0;if(e[0]&&Array===e[0].constructor&&(e=e[0]),n=e.length,n>0)for(t=0;n>t;t++)r+=e[t];return r},avg:function(){var t,n,e=arguments,r=0;if(e[0]&&Array===e[0].constructor&&(e=e[0]),n=e.length,n>0){for(t=0;n>t;t++)r+=e[t];r/=n}return r},ary_eq:function(t,n){var e,r=t.length;if(r!==n.length)return!1;for(e=0;r>e;e++)if(t[e]!=n[e])return!1;return!0},ary_merge:function(t,n){return[].concat(t,n)},match:function(t,n){return n.test(t)},contains:function(t,n){return t.substr||t.pop?-1<t.indexOf(n):t.hasOwnProperty(n)},time:M,date:N}),Y=!0,!0===t&&a.defaultConfiguration())},a.defaultConfiguration=function(){j||(a.defOp({"(":o(["(",-1,")"],K,k,0,"$0",X),")":o([-1,")"]),"[":o(["[",1,"]"],K,k,2,"[$0]",tn),"]":o([-1,"]"]),",":o([1,",",1],V,z,3,"$0,$1",q),"?":o([1,"?",1,":",1],V,k,100,"($0?$1:$2)",Q),":":o([1,":",1]),"!":o(["!",1],L,k,10,"!$0",Q),"~":o(["~",1],L,k,10,"~$0",Z),"^":o([1,"^",1],V,k,11,"Math.pow($0,$1)",Z),"*":o([1,"*",1],V,z,20,"($0*$1)",Z),"/":o([1,"/",1],V,z,20,"($0/$1)",Z),"%":o([1,"%",1],V,z,20,"($0%$1)",Z),"+":o().Polymorphic([["${TOK} && !${PREV_IS_OP} && (${DEDUCED_TYPE}===Xpresion.T_ARY)",o([1,"+",1],V,z,25,"Fn.ary_merge($0,$1)",tn)],["${TOK} && !${PREV_IS_OP} && (${DEDUCED_TYPE}===Xpresion.T_STR)",o([1,"+",1],V,z,25,"($0+String($1))",G)],["${TOK} && !${PREV_IS_OP}",o([1,"+",1],V,z,25,"($0+$1)",Z)],["!${TOK} || ${PREV_IS_OP}",o(["+",1],L,k,4,"$0",Z)]]),"-":o().Polymorphic([["${TOK} && !${PREV_IS_OP}",o([1,"-",1],V,z,25,"($0-$1)",Z)],["!${TOK} || ${PREV_IS_OP}",o(["-",1],L,k,4,"(-$0)",Z)]]),">>":o([1,">>",1],V,z,30,"($0>>$1)",Z),"<<":o([1,"<<",1],V,z,30,"($0<<$1)",Z),">":o([1,">",1],V,z,35,"($0>$1)",Q),"<":o([1,"<",1],V,z,35,"($0<$1)",Q),">=":o([1,">=",1],V,z,35,"($0>=$1)",Q),"<=":o([1,"<=",1],V,z,35,"($0<=$1)",Q),"==":o().Polymorphic([["${DEDUCED_TYPE}===Xpresion.T_ARY",o([1,"==",1],V,z,40,"Fn.ary_eq($0,$1)",Q)],["true",o([1,"==",1],V,z,40,"($0==$1)",Q)]]),"!=":o([1,"!=",1],V,z,40,"($0!=$1)",Q),is:o([1,"is",1],V,z,40,"($0===$1)",Q),matches:o([1,"matches",1],V,I,40,"$0.test($1)",Q),"in":o([1,"in",1],V,I,40,"Fn.contains($1,$0)",Q),"&":o([1,"&",1],V,z,45,"($0&$1)",Z),"|":o([1,"|",1],V,z,46,"($0|$1)",Z),"&&":o([1,"&&",1],V,z,47,"($0&&$1)",Q),"||":o([1,"||",1],V,z,48,"($0||$1)",Q),or:i("||"),and:i("&&"),not:i("!")}),a.defFunc({min:l("min","Math.min($0)",Z),max:l("max","Math.max($0)",Z),pow:l("pow","Math.pow($0)",Z),sqrt:l("sqrt","Math.sqrt($0)",Z),len:l("len","Fn.len($0)",Z),"int":l("int","parseInt($0)",Z),str:l("str","String($0)",G),clamp:l("clamp","Fn.clamp($0)",Z),sum:l("sum","Fn.sum($0)",Z),avg:l("avg","Fn.avg($0)",Z),time:l("time","Fn.time()",Z,1,0),date:l("date","Fn.date($0)",G)}),a.defRE({t_spc:/^(\s+)/,t_nonspc:/^(\S+)/,t_special:/^([*.\-+\\\/\^\$\(\)\[\]|?<:>&~%!#@=_,;{}]+)/,t_num:/^(\d+(\.\d+)?)/,t_ident:/^([a-zA-Z_][a-zA-Z0-9_]*)\b/,t_var:/^\$([a-zA-Z0-9_][a-zA-Z0-9_.]*)\b/}),a.defBlock({"'":{type:G,parse:a.parse_delimited_block},'"':i("'"),"`":{type:W,parse:a.parse_delimited_block,rest:function(t,n,e){for(var r,i="",u=!1,o=!1,l=0,a=n+l,s=!0;e>a&&s;)r=t.charAt(a++),l+=1,"i"!==r||u||(i+="i",u=!0),"g"!==r||o||(i+="g",o=!0),(l>=2||!u&&!o)&&(s=!1);return i}}}),a.defReserved({"null":u(B,"null","null"),"false":u(Q,"false","false"),"true":u(Q,"true","true"),infinity:u(Z,"Infinity","Fn.INF"),nan:u(Z,"NaN","Fn.NAN"),none:i("null"),inf:i("infinity")}),j=!0)},a.init(),a});
/**
*
*   Xpresion
*   Simple eXpression parser engine with variables and custom functions support for PHP, Python, Node/JS, ActionScript
*   @version: 0.5.2
*
*   https://github.com/foo123/Xpresion
*
**/
!function(t,n,e){"use strict";var r,i="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[n]=module.$deps[n]||e.call(t,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(n,r,i){return e.call(t,{AMD:i})}):n in t||(t[n]=r=e.call(t,{})||1)&&l&&define(n,[],function(){return r})}(this,"Xpresion",function(t,n){"use strict";var e,r,i,l,u,o,s,a="0.5.2",c="prototype",p="hasOwnProperty",f=JSON.stringify,h=Object.keys,_=Object.create,d=function(t,n){return new Function(t,n)},y=function(t,n){return new RegExp(t,n||"")},v=/\n\r|\r\n|\n|\r/g,g=/'/g,$=function(){return null},m="BLOCKS",R="OPERATORS",b="FUNCTIONS",E=!1,O=!1;s=function Y(t){var n=this;return n instanceof Y?(n.source=t||"",n.setup(),void Y.parse(n)):new Y(t)},s.VERSION=a;var T=(s.COMMA=",",s.LPAREN="(",s.RPAREN=")",s.NONE=0),P=s.DEFAULT=1,F=s.LEFT=-2,x=s.RIGHT=2,N=s.PREFIX=2,S=s.INFIX=4,A=s.POSTFIX=8,I=s.T_DUM=0,D=s.T_DFT=1,j=s.T_IDE=16,C=s.T_VAR=17,w=s.T_LIT=32,M=s.T_NUM=33,k=s.T_STR=34,z=s.T_REX=35,V=s.T_BOL=36,L=(s.T_DTM=37,s.T_ARY=38),X=s.T_OP=128,K=s.T_N_OP=129,U=s.T_POLY_OP=130,q=s.T_FUN=131;return s.Tpl=e=function B(t,n,e){var r=this;return r instanceof B?(r.id=null,r._renderer=null,r.tpl=B.multisplit(t||"",n||B.defaultArgs),!0===e&&(r._renderer=B.compile(r.tpl)),void r.fixRenderer()):new B(t,n,e)},e.defaultArgs={"$-5":-5,"$-4":-4,"$-3":-3,"$-2":-2,"$-1":-1,$0:0,$1:1,$2:2,$3:3,$4:4,$5:5},e.multisplit=function(t,n,e){var r,i,l,u,o,s,a,c,p,f;e=!!e,s=[[1,t]];for(r in n)if(n.hasOwnProperty(r)){for(c=[],i=e?n[r]:r,l=[0,n[r]],u=0,p=s.length;p>u;u++)if(1===s[u][0]){if(a=s[u][1].split(i),f=a.length,c.push([1,a[0]]),f>1)for(o=0;f-1>o;o++)c.push(l),c.push([1,a[o+1]])}else c.push(s[u]);s=c}return s},e.multisplit_re=function(t,n){for(var e,r=[],i=0;e=n.exec(t);)r.push([1,t.slice(i,n.lastIndex-e[0].length)]),r.push([0,e[1]?e[1]:e[0]]),i=n.lastIndex;return r.push([1,t.slice(i)]),r},e.arg=function(t,n){var e,r,i,l,u,o="args";if(arguments.length&&null!=t)for(t=t.substr?t.length?t.split("."):[]:[t],l=t.length,u=!(!n||!n.substr),e=0;l>e;e++)r=t[e],i=+r,isNaN(i)?o+='["'+r+'"]':(0>i&&(r=u?n+-i:o+".length-"+-i),o+="["+r+"]");return o},e.compile=function(t,n){var r,i,l,u,o=t.length;if(!0===n){for(u='"use strict"; return (',r=0;o>r;r++)i=t[r][0],l=t[r][1],u+=i?l:e.arg(l);u+=");"}else{for(u='"use strict"; var argslen=args.length; return (',r=0;o>r;r++)i=t[r][0],l=t[r][1],u+=i?"'"+l.replace(g,"\\'").replace(v,"' + \"\\n\" + '")+"'":" + String("+e.arg(l,"argslen")+") + ";u+=");"}return d("args",u)},e[c]={constructor:e,id:null,tpl:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[c].render,this},render:function(t){t=t||[];var n,e,r,i=this.tpl,l=i.length,u=t.length,o="";for(n=0;l>n;n++)e=i[n][0],r=i[n][1],o+=e?r:!r.substr&&0>r?t[u+r]:t[r];return o}},s.Alias=i=function Z(t){return this instanceof Z?void(this.alias=t):new Z(t)},i.get_entry=function(t,n){if(n&&t&&t[p](n)){for(var e=t[n];e instanceof i&&t[p](e.alias);){if(n=e.alias,e===t[n])return!1;e=t[n]}return e}return!1},s.Node=r=function G(t,n,e,r){var i=this;return i instanceof G?(i.type=t,i.node=n,i.children=e||null,void(i.pos=r||0)):new G(t,n,e,r)},r[c]={constructor:r,type:null,node:null,children:null,pos:null,op_parts:null,op_index:null,op_next:function(t){var n=this,e=0===n.op_parts.indexOf(t.input);return e&&n.op_parts.shift(),e},op_complete:function(){return!this.op_parts.length},dispose:function(){var t,n,e=this,r=e.children;if(r&&(t=r.length))for(n=0;t>n;n++)r[n]&&r[n].dispose();return e.type=null,e.pos=null,e.node=null,e.op_parts=null,e.op_index=null,r=e.children=null,e},toString:function(){var t,n=[],e=this.node,r=this.children?this.children:[],i=r.length,l=arguments.length&&arguments[0].substr?arguments[0]:"",u=l+"  ";for(t=0;i>t;t++)n.push(r[t].toString(u));return l+["Node("+e.type+"): "+(e.parts?e.parts.join(" "):e.input),"Childs: [",l+n.join("\n"+l),"]"].join("\n"+l)+"\n"}},r.DFT=function(t,n,e){e=!1!==e,n=n||s.render;for(var r,i,l,u=[t],o=[];u.length;)r=u[0],r.children&&r.children.length?(u=r.children.concat(u),r.children=null):(u.shift(),i=r.node,l=n(i,i.arity?o.splice(o.length-i.arity,i.arity):[]),o.push(l),e&&r.dispose());return u=null,o[0]},s.reduce=function(t,n,e,i,l){var u,o,s,a,c,p=null,f=0;if(i)if(a=i,U===a.type&&(a=a.morph([l,t,n])),K===a.type)s=a.node(null,l,n.length+1),e.unshift(s),n.unshift(s);else{if(e.length&&(p=e[0],f=p.op_index),p&&p.op_next(a)){for(;n.length>f;)u=n.shift(),o=u.node,s=o.node(t.splice(t.length-o.arity,o.arity),u.pos),t.push(s);if(!p.op_complete())return;e.shift(),n.shift(),a=p.node,p.dispose(),f=e.length?e[0].op_index:0}if(c=a.fixity,A===c)s=a.node(t.splice(t.length-a.arity,a.arity),l),t.push(s);else if(N===c)n.unshift(r(a.otype,a,null,l));else{for(;n.length>f;){if(u=n.shift(),o=u.node,!(o.priority<a.priority||o.priority===a.priority&&(o.associativity<a.associativity||o.associativity===a.associativity&&o.associativity<0))){n.unshift(u);break}s=o.node(t.splice(t.length-o.arity,o.arity),u.pos),t.push(s)}n.unshift(r(a.otype,a,null,l))}}else for(;n.length;)u=n.shift(),o=u.node,s=o.node(t.splice(t.length-o.arity,o.arity),u.pos),t.push(s)},s.parse_delimited_block=function(t,n,e,r,i){var l=r,u=!1,o="";for(i=!1!==i,n+=1;e>n&&(o=t.charAt(n++),l+=o,r!==o||u);)u=i?!u&&"\\"===o:!1;return l},s.parse=function(t){var n,e,r,l,u,o,a,c,f,_,d,y,v,g,$,R,b=s.reduce,E=i.get_entry,O=t.RE,T=t[m],P=!O[p]("t_var"),F=0;for(n=t.source,e=n.length,t._cnt=0,t._symbol_table={},t._cache={},t.variables={},f=[],_=[],d=[],y=0,o=0;e>o;)if(l=n.charAt(o),(v=E(T,l))&&(u=v.parse(n,o,e,l),!1!==u&&(o+=u.length,g=v[p]("rest")?v.rest(n,o,e)||"":"",o+=g.length,c=t.t_block(u,v.type,g),!1!==c)))y+=1,f.push(c.node(null,y));else if(r=n.slice(o),a=r.match(O.t_spc))o+=a[0].length;else if((a=r.match(O.t_num))&&(c=t.t_liter(a[1],M),!1!==c))y+=1,f.push(c.node(null,y)),o+=a[0].length;else{if(a=r.match(O.t_ident)){if(c=t.t_liter(a[1],j),!1!==c){y+=1,f.push(c.node(null,y)),o+=a[0].length;continue}if(c=t.t_op(a[1]),!1!==c){y+=1,b(f,_,d,c,y),o+=a[0].length;continue}if(P&&(c=t.t_var(a[1]),!1!==c)){y+=1,f.push(c.node(null,y)),o+=a[0].length;continue}}if(a=r.match(O.t_special)){for(u=a[1],c=!1;u.length>0&&(c=t.t_op(u),!1===c);)u=u.slice(0,-1);if(!1!==c){y+=1,b(f,_,d,c,y),o+=u.length;continue}}if(P||!(a=r.match(O.t_var))||(c=t.t_var(a[1]),!1===c)){if(a=r.match(O.t_nonspc)){if(c=t.t_liter(a[1],w),!1!==c){y+=1,f.push(c.node(null,y)),o+=a[0].length;continue}if(c=t.t_op(a[1]),!1!==c){y+=1,b(f,_,d,c,y),o+=a[0].length;continue}c=t.t_tok(a[1]),y+=1,f.push(c.node(null,y)),o+=a[0].length}}else y+=1,f.push(c.node(null,y)),o+=a[0].length}if(F=0,b(f,_,d),(1!==f.length||_.length>0)&&(F=1,R="Parse Error, Mismatched Parentheses or Operators"),!F)try{$=t.compile(f[0])}catch(r){F=1,R="Compilation Error, "+r.message}return d=null,_=null,f=null,t._symbol_table=null,F?($=null,t.variables=[],t._cnt=0,t._cache={},t._evaluator_str="",t._evaluator=t.dummy_evaluator,console.error("Xpresion Error: "+R+" at "+n)):(t.variables=h(t.variables),t._evaluator_str=$[0],t._evaluator=$[1]),t},s.render=function(t,n){return t.render(n)},s.defRE=function(t,n){if("object"==typeof t){n=n||s.RE;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.defBlock=function(t,n){if("object"==typeof t){n=n||s[m];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.defReserved=function(t,n){if("object"==typeof t){n=n||s.Reserved;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.defOp=function(t,n){if("object"==typeof t){n=n||s[R];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.defFunc=function(t,n){if("object"==typeof t){n=n||s[b];for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.defRuntimeFunc=function(t,n){if("object"==typeof t){n=n||s.Fn;for(var e in t)t[p](e)&&(n[e]=t[e])}return n},s.Tok=l=function H(t,n,e,r){var i=this;return i instanceof H?(i.type=t,i.input=n,i.output=e,i.value=r||null,i.priority=1e3,i.parity=0,i.arity=0,i.associativity=P,i.fixity=S,i.parenthesize=!1,void(i.revert=!1)):new H(t,n,e,r)},l.render=function(t){return t instanceof l?t.render():String(t)},l[c]={constructor:l,type:null,input:null,output:null,value:null,priority:1e3,parity:0,arity:0,associativity:P,fixity:S,parenthesize:!1,revert:!1,dispose:function(){var t=this;return t.type=null,t.input=null,t.output=null,t.value=null,t.priority=null,t.parity=null,t.arity=null,t.associativity=null,t.fixity=null,t.parenthesize=null,t.revert=null,t},setType:function(t){return this.type=t,this},setParenthesize:function(t){return this.parenthesize=!!t,this},setReverse:function(t){return this.revert=!!t,this},render:function(t){var n,r=this,i=r.output,l=r.parenthesize,u=l?s.LPAREN:"",o=l?s.RPAREN:"";return t||(t=[]),t.unshift(r.input),n=i instanceof e?i.render(t):i,u+n+o},node:function(t,n){return r(this.type,this,t?t:null,n)},toString:function(){return String(this.output)}},s.Op=u=function J(t,r,i,u,o,s,a,c){var p=this;return p instanceof J?(t=t||"",s=s||"",p.parts=[].concat(t),p.type=t&&t.push&&t.pop?K:X,!s||s instanceof e||(s=e(s)),l.call(p,p.type,p.parts[0],s),p.fixity=r||N,p.associativity=i||P,p.priority=u||1e3,p.arity=o||0,p.otype=n!==a?a:D,p.ofixity=n!==c?c:p.fixity,p.parenthesize=!1,p.revert=!1,void(p.morphes=null)):new J(t,r,i,u,o,s,a,c)},u.Condition=function(t){return["function"==typeof t[0]?t[0]:e.compile(e.multisplit(t[0],{"${POS}":0,"${TOKS}":1,"${OPS}":2,"${TOK}":3,"${OP}":4,"${PREV_IS_OP}":5,"${DEDUCED_TYPE}":6,Xpresion:7}),!0),t[1]]},u[c]=_(l[c]),u[c].otype=null,u[c].ofixity=null,u[c].parts=null,u[c].morphes=null,u[c].dispose=function(){var t=this;return l[c].dispose.call(t),t.otype=null,t.ofixity=null,t.parts=null,t.morphes=null,t},u[c].Polymorphic=function(t){var n=this;return n.type=U,n.morphes=(t||[]).map(u.Condition),n},u[c].morph=function(t){var n,e=this.morphes,r=e.length,i=0,l=e[0][1],u=!1;for(t.length<8&&(t.push(t[1].length?t[1][t[1].length-1]:!1),t.push(t[2].length?t[2][0]:!1),t.push(t[4]?t[4].pos+1===t[0]:!1),t.push(t[4]?t[4].type:t[3]?t[3].type:0),t.push(s));r>i;){if(n=e[i++],!0===Boolean(n[0](t))){n=n[1],u=!0;break}n[1].priority>=l.priority&&(l=n[1])}for(u||(n=l);U===n.type;)n=n.morph(t);return n},u[c].render=function(t){t&&t.length||(t=["",""]);{var n,r=this,i=r.otype,u=r.output,o=r.parenthesize,a=o?s.LPAREN:"",c=o?s.RPAREN:"",p=s.COMMA,f=r.ofixity;t.length}return n=u instanceof e?a+u.render(t)+c:S===f?a+t.join(u)+c:A===f?a+t.join(p)+c+u:u+a+t.join(p)+c,l(i,n,n)},u[c].node=function(t,n){t=t||[];var e,i=this,l=i.otype;return i.revert&&t.reverse(),I===l&&t.length?l=t[0].type:t.length&&(t[0].type=l),e=r(l,i,t,n),K===i.type&&arguments.length>2&&(e.op_parts=i.parts.slice(1),e.op_index=arguments[2]),e},s.Func=o=function Q(t,n,e,r,i,l){var o=this;return o instanceof Q?(u.call(o,t,N,i||x,r||5,1,n,e,l||N),void(o.type=q)):new Q(t,n,e,r,i,l)},o[c]=_(u[c]),s[c]={constructor:s,source:null,variables:null,RE:null,Reserved:null,BLOCKS:null,OPERATORS:null,FUNCTIONS:null,Fn:null,_cnt:0,_cache:null,_symbol_table:null,_evaluator_str:null,_evaluator:null,dummy_evaluator:null,dispose:function(){var t=this;return t.RE=null,t.Reserved=null,t[m]=null,t[R]=null,t[b]=null,t.Fn=null,t.dummy_evaluator=null,t.source=null,t.variables=null,t._cnt=null,t._symbol_table=null,t._cache=null,t._evaluator_str=null,t._evaluator=null,t},setup:function(){var t=this;return t.RE=s.RE,t.Reserved=s.Reserved,t[m]=s[m],t[R]=s[R],t[b]=s[b],t.Fn=s.Fn,t.dummy_evaluator=$,t},compile:function(t){var n=r.DFT(t,s.render,!0),e=d("Fn,Cache",["return function evaluator(Var){",'    "use strict";',"    return "+n+";","};"].join("\n"));return[n,e(this.Fn,this._cache)]},evaluator:function(t){return arguments.length?(t&&t.call&&(this._evaluator=t),this):this._evaluator},evaluate:function(t){return 1>arguments.length&&(t={}),this._evaluator(t)},debug:function(t){var n=this,e=["Expression: "+n.source,"Variables : ["+n.variables.join(",")+"]","Evaluator : "+n._evaluator_str];return arguments.length&&(e.push("Data      : "+f(t,null,4)),e.push("Result    : "+f(n.evaluate(t)))),e.join("\n")},toString:function(){return"[Xpresion source]: "+this.source},t_liter:function(t,n){return M===n?l(M,t,t):i.get_entry(this.Reserved,t.toLowerCase())},t_block:function(t,n,e){if(k===n)return l(k,t,t);if(z===n){e=e||"";var r,i,u="re_"+t+e;return this._symbol_table[p](u)?r=this._symbol_table[u]:(r="re_"+ ++this._cnt,i=t.slice(1,-1),this._cache[r]=y(i,e),this._symbol_table[u]=r),l(z,t,"Cache."+r)}return!1},t_var:function(t){return this.variables[p](t)||(this.variables[t]=t),l(C,t,'Var["'+t.split(".").join('"]["')+'"]')},t_op:function(t){var n=!1;return n=i.get_entry(this[b],t),!1===n&&(n=i.get_entry(this[R],t)),n},t_tok:function(t){return l(D,t,t)}},s.init=function(t){E||(s[R]={},s[b]={},s.Fn={},s.RE={},s[m]={},s.Reserved={},s.defRuntimeFunc({INF:1/0,NAN:0/0,clamp:function(t,n,e){return n>e?t>n?n:e>t?e:t:t>e?e:n>t?n:t},len:function(t){return t?t.substr||t.push?t.length:Object===t.constructor?h(t).length:1:0},sum:function(){var t,n,e=arguments,r=0;if(e[0]&&Array===e[0].constructor&&(e=e[0]),n=e.length,n>0)for(t=0;n>t;t++)r+=e[t];return r},avg:function(){var t,n,e=arguments,r=0;if(e[0]&&Array===e[0].constructor&&(e=e[0]),n=e.length,n>0){for(t=0;n>t;t++)r+=e[t];r/=n}return r},ary_eq:function(t,n){var e,r=t.length;if(r!==n.length)return!1;for(e=0;r>e;e++)if(t[e]!=n[e])return!1;return!0},ary_merge:function(t,n){return[].concat(t,n)},match:function(t,n){return n.test(t)},contains:function(t,n){return t.substr||t.pop?-1<t.indexOf(n):t.hasOwnProperty(n)}}),E=!0,!0===t&&s.defaultConfiguration())},s.defaultConfiguration=function(){O||(s.defOp({"(":u(["(",")"],A,x,1,1,"$0",I),")":u(")"),"[":u(["[","]"],A,x,2,1,"[$0]",L),"]":u("]"),",":u(",",S,F,3,2,"$0,$1",D),"?":u(["?",":"],S,x,100,3,"($0?$1:$2)",V),":":u(":"),"!":u("!",N,x,10,1,"!$0",V),"~":u("~",N,x,10,1,"~$0",M),"^":u("^",S,x,11,2,"Math.pow($0,$1)",M),"*":u("*",S,F,20,2,"($0*$1)",M),"/":u("/",S,F,20,2,"($0/$1)",M),"%":u("%",S,F,20,2,"($0%$1)",M),"+":u().Polymorphic([["${TOK} && !${PREV_IS_OP} && (${DEDUCED_TYPE}===Xpresion.T_ARY)",u("+",S,F,25,2,"Fn.ary_merge($0,$1)",L)],["${TOK} && !${PREV_IS_OP} && (${DEDUCED_TYPE}===Xpresion.T_STR)",u("+",S,F,25,2,"($0+String($1))",k)],["${TOK} && !${PREV_IS_OP}",u("+",S,F,25,2,"($0+$1)",M)],["!${TOK} || ${PREV_IS_OP}",u("+",N,x,4,1,"$0",M)]]),"-":u().Polymorphic([["${TOK} && !${PREV_IS_OP}",u("-",S,F,25,2,"($0-$1)",M)],["!${TOK} || ${PREV_IS_OP}",u("-",N,x,4,1,"(-$0)",M)]]),">>":u(">>",S,F,30,2,"($0>>$1)",M),"<<":u("<<",S,F,30,2,"($0<<$1)",M),">":u(">",S,F,35,2,"($0>$1)",V),"<":u("<",S,F,35,2,"($0<$1)",V),">=":u(">=",S,F,35,2,"($0>=$1)",V),"<=":u("<=",S,F,35,2,"($0<=$1)",V),"==":u().Polymorphic([["${DEDUCED_TYPE}===Xpresion.T_ARY",u("==",S,F,40,2,"Fn.ary_eq($0,$1)",V)],["true",u("==",S,F,40,2,"($0==$1)",V)]]),"!=":u("!=",S,F,40,2,"($0!=$1)",V),matches:u("matches",S,T,40,2,"$0.test($1)",V),"in":u("in",S,T,40,2,"Fn.contains($1,$0)",V),"&":u("&",S,F,45,2,"($0&$1)",M),"|":u("|",S,F,46,2,"($0|$1)",M),"&&":u("&&",S,F,47,2,"($0&&$1)",V),"||":u("||",S,F,48,2,"($0||$1)",V),or:i("||"),and:i("&&"),not:i("!")}),s.defFunc({min:o("min","Math.min($0)",M),max:o("max","Math.max($0)",M),pow:o("pow","Math.pow($0)",M),sqrt:o("sqrt","Math.sqrt($0)",M),len:o("len","Fn.len($0)",M),"int":o("int","parseInt($0)",M),str:o("str","String($0)",k),clamp:o("clamp","Fn.clamp($0)",M),sum:o("sum","Fn.sum($0)",M),avg:o("avg","Fn.avg($0)",M)}),s.defRE({t_spc:/^(\s+)/,t_nonspc:/^(\S+)/,t_special:/^([*.\-+\\\/\^\$\(\)\[\]|?<:>&~%!#@=_,;{}]+)/,t_num:/^(\d+(\.\d+)?)/,t_ident:/^([a-zA-Z_][a-zA-Z0-9_]*)\b/,t_var:/^\$([a-zA-Z0-9_][a-zA-Z0-9_.]*)\b/}),s.defBlock({"'":{type:k,parse:s.parse_delimited_block},'"':i("'"),"`":{type:z,parse:s.parse_delimited_block,rest:function(t,n,e){for(var r,i="",l=!1,u=!1,o=0,s=n+o,a=!0;e>s&&a;)r=t.charAt(s++),o+=1,"i"!==r||l||(i+="i",l=!0),"g"!==r||u||(i+="g",u=!0),(o>=2||!l&&!u)&&(a=!1);return i}}}),s.defReserved({"null":l(j,"null","null"),"false":l(V,"false","false"),"true":l(V,"true","true"),infinity:l(M,"Infinity","Fn.INF"),nan:l(M,"NaN","Fn.NAN"),none:i("null"),inf:i("infinity")}),O=!0)},s.init(),s});
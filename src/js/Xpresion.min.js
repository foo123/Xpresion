/**
*
*   Xpresion
*   Simple eXpression parser engine with variables and custom functions support for PHP, Python, Node.js and Browser
*   @version: 1.0.0
*
*   https://github.com/foo123/Xpresion
*
**/
!function(t,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(t.$deps=t.$deps||{})&&(t.EXPORTED_SYMBOLS=[n])&&(t[n]=t.$deps[n]=e.call(t)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(t)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System.import?System.register(n,[],function(i){i(n,e.call(t))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(t)}):n in t||(t[n]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[n]})}("undefined"!=typeof self?self:this,"Xpresion",function(t){"use strict";function n(t,n){return t&&F.call(t,n)?1:0}function e(t,n,e,i){var l=String(t);if(e=e||"0",i)for(;l.length<n;)l+=e;else for(;l.length<n;)l=e+l;return l}function i(){return i.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(i.GUID.toString(16),4)}function l(t){return t instanceof Array||"[object Array]"===A.call(t)}function r(t,n,e){for(var i,l="";n<e&&(" "===(i=t[V](n))||"\r"===i||"\t"===i||"\v"===i||"\0"===i);)l+=i,n+=1;return l}function o(t,n){var e,i,l,r=t.length;if(r&&n.length)for(e="",l=0;l<r;l++)e+=i=t[V](l),"\n"===i&&(e+=n);else e=t;return e}function u(t,n,e,i){var l,r,o,u,a=0;if(n)for(l=t,r=n.length,o=0,a=1;o<r;){if(u=n[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&e)for(l=t,r=e.length,o=0,a=1;o<r;){if(u=e[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&null!=i&&i!==t){if(n)for(l=i,r=n.length,o=0,a=1;o<r;){if(u=n[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&e)for(l=i,r=e.length,o=0,a=1;o<r;){if(u=e[o++],null==l||null==l[u]){a=0;break}l=l[u]}}return a?l:null}function a(t,n){this.prev=t||null,this.value=n||null}function s(t,n){n&&(n.next=this),this.node=t||null,this.prev=n||null,this.next=null}function p(t,n,e,i,r,o,a){var s,p,f,y,h,d,g,v,_=null,m="";if(-1===n.type){if((s=n.opt_args)&&s.value[5])for(;s;){if(p=s.value,f=u(t,p[1],[String(p[0])],p[6]?null:a),null===_&&n.name===p[0]&&(_=f),0===p[2]&&null==f||1===p[2]&&null!=f)return"";s=s.prev}}else _=u(t,n.key,[String(n.name)],n.loc?null:a);if(y=l(_),v=y?_.length:-1,y&&v>n.start)for(h=n.start,d=-1===n.end?v-1:Math.min(n.end,v-1),g=h;g<=d;g++)m+=c(t,n.tpl,e,i,g,o,a);else y||n.start!==n.end||(m=c(t,n.tpl,e,i,null,o,a));return m}function f(t,e,i,r,a,s,f){var c,h,d,g,v="";return e.stpl&&(n(i,e.stpl)||n(y.subGlobal,e.stpl)||n(r,e.stpl)||n(r,"*")||n(y.fnGlobal,e.stpl)||n(y.fnGlobal,"*"))?(c=u(t,e.key,[String(e.name)],e.loc?null:f),n(i,e.stpl)||n(y.subGlobal,e.stpl)?(null==a||0===a&&e.start===e.end&&e.opt||!l(c)||(c=a<c.length?c[a]:null),null==c&&null!==e.dval?v=e.dval:(d=n(i,e.stpl)?i[e.stpl].node:y.subGlobal[e.stpl].node,h={},null!=c&&(l(c)?h[d.name]=c:h=c),v=p(h,d,i,r,null,e.algn?s:"",null==f?t:f))):(g=null,n(r,e.stpl)?g=r[e.stpl]:n(r,"*")?g=r["*"]:n(y.fnGlobal,e.stpl)?g=y.fnGlobal[e.stpl]:y.fnGlobal["*"]&&(g=y.fnGlobal["*"]),l(c)&&(c=(a=null!=a?a:e.start)<c.length?c[a]:null),v=null==(c="function"==typeof g?g(c,{symbol:e,index:a,currentArguments:t,originalArguments:f,alignment:s}):String(g))&&null!==e.dval?e.dval:String(c),e.algn&&(v=o(v,s)))):e.opt&&null!==e.dval?v=e.dval:(l(c=u(t,e.key,[String(e.name)],e.loc?null:f))&&(c=(a=null!=a?a:e.start)<c.length?c[a]:null),v=null==c&&null!==e.dval?e.dval:String(c),e.algn&&(v=o(v,s))),v}function c(t,n,e,i,l,r,o){for(var u,a=r=r||"",s="";n;)-1===(u=n.node.type)?s+=p(t,n.node,e,i,l,n.node.algn?a:r,o):1===u?s+=f(t,n.node,e,i,l,n.node.algn?a:r,o):0===u?(a+=n.node.algn,s+=n.node.val):100===u&&(a=r,s+="\n"+r),n=n.next;return s}function y(t,n,e){var i=this;if(!(i instanceof y))return new y(t,n,e);i.id=null,i.tpl=null,i.fn={},i._args=[t||"",n||y.defaultDelimiters,e||!1]}function h(t,n){return new Function(t,n)}function d(t,n){return new RegExp(t,n||"")}function g(t){return t instanceof String||"[object String]"===A.call(t)}function v(t){return"[object Object]"===A.call(t)}function _(t,n,e){var i=t.toString(),l=n-i.length;return l>0?new Array(l+1).join(e||" ")+i:i}function m(){return j((new Date).getTime()/1e3)}function b(t,n){if(!arguments.length)return"";var e,i,l,r,o,u,a=G,s={},p=(o=n instanceof Date?new Date(n):"number"==typeof n?new Date(1e3*n):new Date).getTimezoneOffset(),f=Y(p),c=o.getMonth();for(s.G=o.getHours(),s.j=o.getDate(),u=s.j%10,s.n=c+1,s.Y=o.getFullYear(),s.w=o.getDay(),s.N=s.w||7,s.d=_(s.j,2,"0"),s.D=a.day_short[s.w],s.l=a.day[s.w],s.S=a.ordinal.ord[s.j]?a.ordinal.ord[s.j]:a.ordinal.ord[u]?a.ordinal.ord[u]:a.ordinal.nth,s.z=I((new Date(s.Y,c,s.j)-new Date(s.Y,0,1))/864e5),s.W=_(1+I((new Date(s.Y,c,s.j-s.N+3)-new Date(s.Y,0,4))/864e5/7),2,"0"),s.F=a.month[c],s.m=_(s.n,2,"0"),s.M=a.month_short[c],s.t=new Date(s.Y,c+1,0).getDate(),s.L=s.Y%4==0&s.Y%100!=0|s.Y%400==0,s.o=s.Y+(11===c&&s.W<9?1:0===c&&s.W>9?-1:0),s.y=s.Y.toString().slice(-2),s.a=s.G>11?a.meridian.pm:a.meridian.am,s.A=s.G>11?a.meridian.PM:a.meridian.AM,s.B=_(j((3600*o.getUTCHours()+60*o.getUTCMinutes()+o.getUTCSeconds()+3600)/86.4)%1e3,3,"0"),s.g=s.G%12||12,s.h=_(s.g,2,"0"),s.H=_(s.G,2,"0"),s.i=_(o.getMinutes(),2,"0"),s.s=_(o.getSeconds(),2,"0"),s.u=_(1e3*o.getMilliseconds(),6,"0"),s.e="",s.I=new Date(s.Y,0)-Date.UTC(s.Y,0)!=new Date(s.Y,6)-Date.UTC(s.Y,6)?1:0,s.O=(p>0?"-":"+")+_(100*j(f/60)+f%60,4,"0"),s.P=s.O.substr(0,3)+":"+s.O.substr(3,2),s.T="UTC",s.Z=60*-p,s.U=o/1e3|0,s.c=[s.Y,"-",s.m,"-",s.d,"\\",s.T,s.H,":",s.i,":",s.s,s.P].join(""),s.r=[s.D,", ",s.d," ",s.M," ",s.Y," ",s.H,":",s.i,":",s.s," ",s.O].join(""),e="",l=0,r=t.length;l<r;l++)i=t.charAt(l),e+=F.call(s,i)?s[i]:i;return e}function S(){return null}function T(t,n,e){return h("Fn,Cache,Xpresion",["return function evaluator(Var){",'    "use strict";',"    return "+t+";","};"].join("\n"))(n,e,O)}function E(t){var n=this;if(!(n instanceof E))return new E(t);n.RE={},n.BLOCKS={},n.RESERVED={},n.OPERATORS={},n.FUNCTIONS={},n.FN={INF:1/0,NAN:NaN},"object"==typeof t&&(t.re&&n.defRE(t.re),t.blocks&&n.defBlock(t.blocks),t.reserved&&n.defReserved(t.reserved),t.operators&&n.defOp(t.operators),t.functions&&n.defFunc(t.functions),t.runtime&&n.defRuntimeFunc(t.runtime))}function O(t,n){var e=this;if(!(e instanceof O))return new O(t,n);n&&n instanceof E||(n=O.defaultConfiguration()),e.source=String(null==t?"":t),e.dummy_evaluator=S,O.parse(e,n)}function $(t){if(!(this instanceof $))return new $(t);this.alias=t}function x(t,n,e,i,l){var r=this;if(!(r instanceof x))return new x(t,n,e,i,l);r.type=t,r.arity=n,r.node=e,r.children=i||null,r.pos=l||0}function R(t,n,e,i){var l=this;if(!(l instanceof R))return new R(t,n,e,i);l.type=t,l.input=n,l.output=e,l.value=i||null,l.priority=1e3,l.parity=0,l.arity=0,l.arity_min=0,l.arity_max=0,l.associativity=X,l.fixity=W,l.parenthesize=!1,l.revert=!1}function w(t,n,e,i,l,r,o){var u=this;if(!(u instanceof w))return new w(t,n,e,i,l,r,o);t=null==t?"":t,n=null==n?"":n;var a=w.parse_definition(t);u.type=a[0],u.opdef=a[1],u.parts=a[2],n instanceof y||(n=new y(String(n))),R.call(u,u.type,u.parts[0],n),u.fixity=null!=i?i:H,u.associativity=null!=l?l:X,u.priority=null!=r?r:1e3,u.arity=a[3],u.arity_min=a[4],u.arity_max=a[5],u.otype=null!=e?e:tt,u.ofixity=null!=o?o:u.fixity,u.parenthesize=!1,u.revert=!1,u.morphes=null}function D(t,n,e,i,l,r,o){var u=this;if(!(u instanceof D))return new D(t,n,e,i,l,r,o);t=null==t?"":t,n=null==n?"":n,w.call(u,g(t)?[t,null!=l?l:1]:t,n,null!=e?e:tt,H,null!=r?r:J,null!=i?i:1,null!=o?o:H),u.type=yt}var P,N="prototype",F=Object[N].hasOwnProperty,A=Object[N].toString,C=JSON.stringify,M=Object.keys,k=Object.create,j=Math.floor,I=Math.round,Y=Math.abs,U=Math.max,G={meridian:{am:"am",pm:"pm",AM:"AM",PM:"PM"},ordinal:{ord:{1:"st",2:"nd",3:"rd"},nth:"th"},timezone:["UTC","EST","MDT"],timezone_short:["UTC","EST","MDT"],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},V="charAt",z=/^\s+|\s+$/g,L=String[N].trim?function(t){return t.trim()}:function(t){return t.replace(z,"")},K=!1;i.GUID=0,y.VERSION="3.0.0",y.defaultDelimiters=["<",">","[","]"],y.fnGlobal={},y.subGlobal={},y.guid=i,y.multisplit=function(t,e,l){var o,u,p,f,c,y,h,d,g,v,_,m,b,S,T,E,O,$,x,R,w,D,P,N,F,A,C=e[0],M=e[1],k=e[2],j=e[3],I=C.length,Y=M.length,U=k.length,G=j.length,z="#"+j,K=null,B=0,X=0,q=0,J=0,H=t.length,W=[C,I,M,Y],Z=[k,U,j,G],Q=[null,0,null,0,null,0,null,0];for(l=!0===l,x={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},w=g=new s({type:0,val:"",algn:""}),D=null,R=null,T={},O=null,E={},$=null,W[1]<W[3]&&(_=W[0],W[2]=W[0],W[0]=_,m=W[1],W[3]=W[1],W[1]=m),Z[1]<Z[3]&&(_=Z[0],Z[2]=Z[0],Z[0]=_,m=Z[1],Z[3]=Z[1],Z[1]=m),u=0,p=0,m=0;4>u&&4>p;)W[u+1]<Z[p+1]?(Q[m]=Z[p],Q[m+1]=Z[p+1],p+=2):(Q[m]=W[u],Q[m+1]=W[u+1],u+=2),m+=2;for(;4>u;)Q[m]=W[u],Q[m+1]=W[u+1],u+=2,m+=2;for(;4>p;)Q[m]=Z[p],Q[m+1]=Z[p+1],p+=2,m+=2;for(h=null,_="",m=0;m<H;)if("\\"!==(d=t[V](m)))if(A=null,Q[0]===t.substr(m,Q[1])?A=Q[0]:Q[2]===t.substr(m,Q[3])?A=Q[2]:Q[4]===t.substr(m,Q[5])?A=Q[4]:Q[6]===t.substr(m,Q[7])&&(A=Q[6]),C===A)m+=I,_.length&&(0===g.node.type?g.node.val+=_:g=new s({type:0,val:_,algn:""},g)),_="";else if(M===A){if(m+=Y,c=_,_="",-1<(y=c.indexOf("|"))?(K=c.slice(y+1),c=c.slice(0,y)):K=null,"?"===(d=l?m<H?t[V](m):"":c[V](0))||"*"===d)X=1,"*"===d?(u=1,p=-1):(u=0,p=0),l?(m+=1)<H&&"!"===t[V](m)?(B=1,m+=1):B=0:"!"===c[V](1)?(B=1,c=c.slice(2)):(B=0,c=c.slice(1));else if("{"===d){if(l){for(_="",b=m+1,S=H;b<S&&"}"!==t[V](b);)_+=t[V](b++);m=b+1}else{for(_="",b=1,S=c.length;b<S&&"}"!==c[V](b);)_+=c[V](b++);c=c.slice(b+1)}(_=_.split(",")).length>1?(u=(u=L(_[0])).length?0|+u:0,p=(p=L(_[1])).length?0|+p:-1,X=1):(p=u=(u=L(_[0])).length?0|+u:0,X=0),_="",B=0}else X=0,B=0,u=0,p=0;if(B&&null===K&&(K=""),"@"===(d=c[V](0))?(q=1,c=c.slice(1)):q=0,"."===(d=c[V](0))?(J=1,c=c.slice(1)):J=0,f=-1<c.indexOf(":")?c.split(":"):[c,null],c=f[0],f=f[1],o=-1<c.indexOf(".")?c.split("."):null,O&&!n(E,O)&&(E[O]={}),":="+k===t.substr(m,2+U)&&(m+=2,$=f=f&&f.length?f:"grtpl--"+i(),O&&c.length&&(E[O][c]=f)),!c.length)continue;null==f&&O&&n(E,O)&&n(E[O],c)&&(f=E[O][c]),X&&!x.opt?(x.name=c,x.key=o,x.stpl=f,x.dval=K,x.opt=X,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p,R=new a(null,[c,o,B,u,p,X,J])):X?(u!==p&&x.start===x.end&&(x.name=c,x.key=o,x.stpl=f,x.dval=K,x.opt=X,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p),R=new a(R,[c,o,B,u,p,X,J])):X||null!==x.name||(x.name=c,x.key=o,x.stpl=f,x.dval=K,x.opt=0,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p,R=new a(null,[c,o,B,u,p,0,J])),0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:1,name:c,key:o,stpl:f,dval:K,opt:X,algn:q,loc:J,start:u,end:p},g)}else if(k===A){if(m+=U,_.length&&(0===g.node.type?g.node.val+=_:g=new s({type:0,val:_,algn:""},g)),_="","#"===t[V](m)){for(b=m+1,S=H;b<S&&z!==t.substr(b,G+1);)_+=t[V](b++);m=b+G+1,0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:-100,val:_},g),_="";continue}h=new a(h,[g,D,x,R,O,$]),$&&(O=$),$=null,x={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},R=null,D=g=new s({type:0,val:"",algn:""})}else j===A?(m+=G,v=g,P=D,N=x,F=R,h?(g=h.value[0],D=h.value[1],x=h.value[2],R=h.value[3],O=h.value[4],$=h.value[5],h=h.prev):g=null,_.length&&(0===v.node.type?v.node.val+=_:v=new s({type:0,val:_,algn:""},v)),_="",$?(T[$]=new s({type:2,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:null,tpl:P}),$=null):(0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:-1,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:F,tpl:P},g))):"\n"===(d=t[V](m++))?(_.length&&(0===g.node.type?g.node.val+=_:g=new s({type:0,val:_,algn:""},g)),_="",0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:100,val:"\n"},g)):_+=d;else _+=m+1<H?t[V](m+1):"",m+=2;return _.length&&(0===g.node.type?g.node.val+=_:g=new s({type:0,val:_,algn:""},g)),0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),[w,T]},y.align=o,y.main=c,y[N]={constructor:y,id:null,tpl:null,fn:null,_args:null,dispose:function(){var t=this;return t.id=null,t.tpl=null,t.fn=null,t._args=null,t},parse:function(){var t=this;return null===t.tpl&&null!==t._args&&(t.tpl=y.multisplit(t._args[0],t._args[1],t._args[2]),t._args=null),t},render:function(t){var n=this;return null===n.tpl&&n.parse(),y.main(null==t?{}:t,n.tpl[0],n.tpl[1],n.fn)}},E[N]={constructor:E,RE:null,BLOCKS:null,RESERVED:null,OPERATORS:null,FUNCTIONS:null,FN:null,dispose:function(){var t=this;return t.RE=null,t.BLOCKS=null,t.RESERVED=null,t.OPERATORS=null,t.FUNCTIONS=null,t.FN=null,t},defRE:function(t){if("object"==typeof t)for(var n in t)F.call(t,n)&&(this.RE[n]=t[n]);return this},defBlock:function(t){if("object"==typeof t)for(var n in t)F.call(t,n)&&(this.BLOCKS[n]=t[n]);return this},defReserved:function(t){if("object"==typeof t)for(var n in t)F.call(t,n)&&(this.RESERVED[n]=t[n]);return this},defOp:function(t){if("object"==typeof t){var n,e;for(n in t)F.call(t,n)&&t[n]&&((e=t[n])instanceof $||e instanceof w?this.OPERATORS[n]=e:e.polymorphic?this.OPERATORS[n]=w().Polymorphic(e.polymorphic.map(function(t){var n,e;return v(t)?(n=t.check,e=t.op):(n=t[0],e=t[1]),e=e instanceof w?e:new w(e.input,e.output,e.otype,e.fixity,e.associativity,e.priority,e.ofixity),[n,e]})):this.OPERATORS[n]=new w(e.input,e.output,e.otype,e.fixity,e.associativity,e.priority,e.ofixity))}return this},defFunc:function(t){if("object"==typeof t){var n,e;for(n in t)F.call(t,n)&&t[n]&&(e=t[n],this.FUNCTIONS[n]=e instanceof $||e instanceof D?e:new D(e.input,e.output,e.otype,e.priority,e.arity,e.associativity,e.ofixity))}return this},defRuntimeFunc:function(t){if("object"==typeof t)for(var n in t)F.call(t,n)&&(this.FN[n]=t[n]);return this}},O.VERSION="1.0.0",O.Configuration=E,O.CONF=null,O.defaultConfiguration=function(t){return arguments.length&&(O.CONF=t),O.CONF};O.COMMA=",",O.LPAREN="(",O.RPAREN=")";var B=O.NONE=0,X=O.DEFAULT=1,q=O.LEFT=-2,J=O.RIGHT=2,H=O.PREFIX=2,W=O.INFIX=4,Z=O.POSTFIX=8,Q=O.T_DUM=0,tt=O.T_MIX=1,nt=O.T_DFT=tt,et=O.T_IDE=16,it=O.T_VAR=17,lt=O.T_LIT=32,rt=O.T_NUM=33,ot=O.T_STR=34,ut=O.T_REX=35,at=O.T_BOL=36,st=(O.T_DTM=37,O.T_ARY=38),pt=O.T_OP=128,ft=O.T_N_OP=129,ct=O.T_POLY_OP=130,yt=O.T_FUN=131,ht=O.T_EMPTY=1024;return O.Tpl=y,O.Alias=$,$.get_entry=function(t,n){if(n&&t&&F.call(t,n)){for(var e=t[n];e instanceof $&&F.call(t,e.alias);){if(n=e.alias,e===t[n])return!1;e=t[n]}return e}return!1},O.Node=x,x[N]={constructor:x,type:null,arity:null,node:null,children:null,pos:null,op_parts:null,op_def:null,op_index:null,op_next:function(t,n,e,i){var l=this,r=0,o=0===l.op_parts.indexOf(t.input);return o&&0===l.op_def[0][0]&&(!1===(r=w.match_args(l.op_def[0][2],n-1,e,i))?o=!1:(l.arity=r,l.op_def.shift())),o&&(l.op_def.shift(),l.op_parts.shift()),o},op_complete:function(){return!this.op_parts.length},dispose:function(){var t,n,e=this,i=e.children;if(i&&(t=i.length))for(n=0;n<t;n++)i[n]&&i[n].dispose();return e.type=null,e.arity=null,e.pos=null,e.node=null,e.op_parts=null,e.op_def=null,e.op_index=null,i=e.children=null,e},toString:function(){var t,n=[],e=this.node,i=this.children?this.children:[],l=i.length;for(t=0;t<l;t++)n.push(i[t].toString());return["Node("+e.type+","+e.arity+"): "+(e.parts?e.parts.join(" "):e.input),"Childs: [",""+n.join("\n"),"]"].join("\n")+"\n"}},x.DFT=function(t,n,e){e=!1!==e,n=n||O.render;for(var i,l,r,o,u=[t],a=[];u.length;)(i=u[0]).children&&i.children.length?(u=i.children.concat(u),i.children=null):(u.shift(),r=(l=i.node).arity,pt&l.type&&0===r?r=1:r>a.length&&l.arity_min<=l.arity&&(r=l.arity_min),o=n(l,r?a.splice(a.length-r,r):[]),a.push(o),e&&i.dispose());return u=null,a[0]},O.reduce=function(t,n,e,i,l,r){var o,u,a,s,p,f,c,y=null,h=0;if(i)if(s=i,ct===s.type&&(s=s.morph([l,t,n])),ft===s.type){if(!1===(f=s.validate(l,n,t))[0])return r.err=!0,r.msg=f[1],!1;(a=s.node(null,l,n,t)).arity=f[0],e.unshift(a),n.unshift(a)}else{if(e.length&&(h=(y=e[0]).op_index),y&&y.op_next(s,l,n,t)){for(;n.length>h;)c=(u=(o=n.shift()).node).arity,pt&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a);if(!y.op_complete())return;e.shift(),n.shift(),s=y.node,y.dispose(),h=e.length?e[0].op_index:0}else if(!1===(f=s.validate(l,n,t))[0])return r.err=!0,r.msg=f[1],!1;if(p=s.fixity,Z===p)(c=s.arity)>t.length&&s.arity_min<=t.length&&(c=s.arity_min),a=s.node(c?t.splice(t.length-c,c):[],l),t.push(a);else if(H===p)n.unshift(x(s.otype,s.arity,s,null,l)),pt&s.type&&0===s.arity&&t.push(P.node(null,l+1));else{for(;n.length>h;){if(o=n.shift(),!((u=o.node).priority<s.priority||u.priority===s.priority&&(u.associativity<s.associativity||u.associativity===s.associativity&&u.associativity<0))){n.unshift(o);break}c=u.arity,pt&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a)}n.unshift(x(s.otype,s.arity,s,null,l))}}else for(;n.length;)c=(u=(o=n.shift()).node).arity,pt&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a)},O.parse_delimited_block=function(t,n,e,i,l){5>arguments.length&&(l=!0);var r=i,o=!1,u="";for(l=!1!==l,n+=1;n<e&&(u=t.charAt(n++),r+=u,i!==u||o);)o=!!l&&(!o&&"\\"===u);return r},O.parse_re_flags=function(t,n,e){for(var i,l="",r=!1,o=!1,u=!1,a=0,s=n+a,p=!0;s<e&&p;)a+=1,"i"!=(i=t.charAt(s++))||r||(l+="i",r=!0),"m"!=i||u||(l+="m",u=!0),"g"!=i||o||(l+="g",o=!0),(a>=3||!r&&!o&&!u)&&(p=!1);return l},O.parse=function(t,n){var e,i,l,r,o,u,a,s,p,f,c,y,h,d,g,v,_=O.reduce,m=$.get_entry,b=!F.call(n.RE,"t_var"),S=0,T={err:!1,msg:""};for(i=(e=String(t.source)).length,u=0,t._cnt=0,t._symbol_table={},t._cache={},t.variables={},p=[],f=[],c=[],y=0,S=0;u<i;)if(r=e.charAt(u),(h=m(n.BLOCKS,r))&&!1!==(o=h.parse(e,u,i,r))&&(u+=o.length,"function"==typeof h.rest?(g=h.rest(e,u,i))||(g=""):g="",u+=g.length,!1!==(s=t.t_block(n,o,h.type,g))))y+=1,p.push(s.node(null,y));else if(l=e.slice(u),a=l.match(n.RE.t_spc))u+=a[0].length;else if((a=l.match(n.RE.t_num))&&!1!==(s=t.t_liter(n,a[1],rt)))y+=1,p.push(s.node(null,y)),u+=a[0].length;else{if(a=l.match(n.RE.t_ident)){if(!1!==(s=t.t_liter(n,a[1],et))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}if(!1!==(s=t.t_op(n,a[1]))){if(y+=1,_(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=a[0].length;continue}if(b&&!1!==(s=t.t_var(n,a[1]))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}}if(a=l.match(n.RE.t_special)){for(o=a[1],s=!1;o.length>0&&!1===(s=t.t_op(n,o));)o=o.slice(0,-1);if(!1!==s){if(y+=1,_(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=o.length;continue}}if(b||!(a=l.match(n.RE.t_var))||!1===(s=t.t_var(n,a[1]))){if(a=l.match(n.RE.t_nonspc)){if(!1!==(s=t.t_liter(n,a[1],lt))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}if(!1!==(s=t.t_op(n,a[1]))){if(y+=1,_(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=a[0].length;continue}S=1,v='Unknown token "'+a[0]+'"';break}}else y+=1,p.push(s.node(null,y)),u+=a[0].length}if(S||(_(p,f,c),(1!==p.length||f.length>0)&&(S=1,v="Parse Error, Mismatched Parentheses or Operators")),!S)try{d=t.compile(p[0],n)}catch(l){S=1,v="Compilation Error, "+l.toString()}if(c=null,f=null,p=null,t._symbol_table=null,S)throw d=null,t.variables=[],t._cnt=0,t._cache={},t.evaluatorString="",t.evaluator=t.dummy_evaluator,new Error("Xpresion Error: "+v+' at "'+e+'"');return t.variables=M(t.variables),t.evaluatorString=d[0],t.evaluator=d[1],t},O.render=function(t,n){return t.render(n)},O.GET=function(t,n){if(!n||!n.length)return t;for(var e,i=0,l=n.length,r=t;i<l&&(e=n[i++],r)&&null!=r[e];)r=r[e];return i===l?r:null},O.Tok=R,R.render=function(t,n){return t instanceof R?t.render(n||[]):String(t)},R[N]={constructor:R,type:null,input:null,output:null,value:null,priority:1e3,parity:0,arity:0,arity_min:0,arity_max:0,associativity:X,fixity:W,parenthesize:!1,revert:!1,dispose:function(){var t=this;return t.type=null,t.input=null,t.output=null,t.value=null,t.priority=null,t.parity=null,t.arity=null,t.arity_min=null,t.arity_max=null,t.associativity=null,t.fixity=null,t.parenthesize=null,t.revert=null,t},setType:function(t){return this.type=t,this},setParenthesize:function(t){return this.parenthesize=!!t,this},setReverse:function(t){return this.revert=!!t,this},render:function(t){var n,e=this,i=e.output,l=e.parenthesize,r=l?O.LPAREN:"",o=l?O.RPAREN:"";return t||(t=[]),t.unshift(e.input),n=i instanceof y?i.render({$:t}):String(i),r+n+o},node:function(t,n){return x(this.type,this.arity,this,t||null,n||0)},toString:function(){return String(this.output)}},P=O.EMPTY_TOKEN=R(ht,"",""),O.Op=w,w.Condition=function(t){if(g(t[0]))try{t[0]=h("curr,Xpresion","return "+t[0]+";")}catch(n){t[0]=null}return["function"==typeof t[0]?t[0]:null,t[1]]},w.parse_definition=function(t){var n,e,i,l,r=[],o=[],u=0,a=0,s=0;for(i=0,l=(t=g(t)?[1,t,1]:[].concat(t)).length;i<l;i++)g(t[i])?(r.push(t[i]),o.push([1,i,t[i]])):(o.push([0,i,t[i]]),u+=n=Y(t[i]),s+=n,a+=t[i]);return 1===r.length&&1===o.length?(o=[[0,0,1],[1,1,r[0]],[0,2,1]],a=s=u=2,e=pt):e=r.length>1?ft:pt,[e,o,r,u,U(0,a),s]},w.match_args=function(t,n,e,i){for(var l,r=i.length-1,o=0,u=Y(t);(o<u||r>=0)&&(l=r>=0?i[r].pos:-10,n===l);)o++,n--,r--;return o>=u?u:t<=0&&0},w[N]=k(R[N]),w[N].otype=null,w[N].ofixity=null,w[N].opdef=null,w[N].parts=null,w[N].morphes=null,w[N].dispose=function(){var t=this;return t.otype=null,t.ofixity=null,t.opdef=null,t.parts=null,t.morphes=null,R[N].dispose.call(t),t},w[N].Polymorphic=function(t){var n=this;return n.type=ct,n.morphes=(t||[]).map(w.Condition),n},w[N].morph=function(t){var n,e,i=this.morphes,l=i.length,r=0,o=i[0][1],u=!1;for(t.length<7&&(t.push(!!t[1].length&&t[1][t[1].length-1]),t.push(!!t[2].length&&t[2][0]),t.push(!!t[4]&&t[4].pos+1===t[0]),t.push(t[4]?t[4].type:t[3]?t[3].type:0)),e={POS:t[0],TOKS:t[1],OPS:t[2],TOK:t[3],OP:t[4],PREV_IS_OP:t[5],DEDUCED_TYPE:t[6]};r<l;){if(n=i[r++],!0===Boolean(n[0](e,O))){n=n[1],u=!0;break}n[1].priority>=o.priority&&(o=n[1])}for(u||(n=o);ct===n.type;)n=n.morph(t);return n},w[N].render=function(t){t&&t.length||(t=["",""]);var n,e=this,i=e.otype,l=e.output,r=e.parenthesize,o=r?O.LPAREN:"",u=r?O.RPAREN:"",a=O.COMMA,s=e.ofixity;t.length;return n=l instanceof y?o+l.render({$:t})+u:W===s?o+t.join(l)+u:Z===s?o+t.join(a)+u+l:l+o+t.join(a)+u,R(i,n,n)},w[N].validate=function(t,n,e){var i=this,l=i.opdef,r="",o=0;return 0===l[0][0]&&!1===(o=w.match_args(l[0][2],t-1,n,e))&&(r='Operator "'+i.input+'" expecting '+l[0][2]+" prior argument(s)"),[o,r]},w[N].node=function(t,n,e,i){t=t||[],n=n||0;var l,r=this,o=r.otype;return r.revert&&t.reverse(),Q===o&&t.length?o=t[0].type:t.length&&(t[0].type=o),l=new x(o,r.arity,r,t,n),ft===r.type&&arguments.length>2&&(l.op_parts=r.parts.slice(1),l.op_def=r.opdef.slice(0===r.opdef[0][0]?2:1),l.op_index=arguments[2].length+1),l},O.Func=D,D[N]=k(w[N]),O[N]={constructor:O,source:null,variables:null,evaluatorString:null,evaluator:null,_cnt:0,_cache:null,_symbol_table:null,dummy_evaluator:null,dispose:function(){var t=this;return t.dummy_evaluator=null,t.source=null,t.variables=null,t.evaluatorString=null,t.evaluator=null,t._cnt=null,t._symbol_table=null,t._cache=null,t},compile:function(t,n){n||(n=O.defaultConfiguration());var e=x.DFT(t,O.render,!0);return[e,T(e,n.FN,this._cache)]},evaluate:function(t){return 1>arguments.length&&(t={}),"function"==typeof this.evaluator?this.evaluator(t):null},debug:function(t){var n=this,e=["Expression: "+n.source,"Variables : ["+n.variables.join(",")+"]","Evaluator : "+n.evaluatorString];return arguments.length&&(e.push("Data      : "+C(t,null,4)),e.push("Result    : "+C(n.evaluate(t)))),e.join("\n")},toString:function(){return"[Xpresion source]: "+String(this.source)},t_liter:function(t,n,e){return rt===e?R(rt,n,n):$.get_entry(t.RESERVED,n.toLowerCase())},t_block:function(t,n,e,i){if(i=i||"",ot===e)return R(ot,n,n);if(ut===e){var l,r,o="re_"+n+i;return F.call(this._symbol_table,o)?l=this._symbol_table[o]:(l="re_"+ ++this._cnt,r=n.slice(1,-1),this._cache[l]=d(r,i),this._symbol_table[o]=l),R(ut,n,"Cache."+l)}return!1},t_var:function(t,n){var e,i=n.split("."),l=i[0];return F.call(this.variables,l)||(this.variables[l]=l),1<i.length?(e='["'+i.slice(1).join('","')+'"]',R(it,l,'Xpresion.GET(Var["'+l+'"],'+e+")")):R(it,l,'Var["'+l+'"]')},t_op:function(t,n){var e=!1;return!1===(e=$.get_entry(t.FUNCTIONS,n))&&(e=$.get_entry(t.OPERATORS,n)),e},t_tok:function(t,n){return R(tt,n,n)}},O.init=function(){K||(K=!0,O.defaultConfiguration(E({re:{t_spc:/^(\s+)/,t_nonspc:/^(\S+)/,t_special:/^([*.\\\-+\/\^\$\(\)\[\]|?<:>&~%!#@=_,;{}]+)/,t_num:/^(\d+(\.\d+)?)/,t_ident:/^([a-zA-Z_][a-zA-Z0-9_]*)\b/,t_var:/^\$([a-zA-Z0-9_][a-zA-Z0-9_.]*)\b/},blocks:{"'":{type:ot,parse:O.parse_delimited_block},'"':$("'"),"`":{type:ut,parse:O.parse_delimited_block,rest:O.parse_re_flags}},reserved:{null:R(et,"null","null"),false:R(at,"false","false"),true:R(at,"true","true"),infinity:R(rt,"Infinity","Infinity"),nan:R(rt,"NaN","NaN"),none:$("null"),inf:$("infinity")},operators:{"(":{input:["(",-1,")"],output:"<$.0>",otype:Q,fixity:Z,associativity:J,priority:0},")":{input:[-1,")"]},"[":{input:["[",-1,"]"],output:"\\[<$.0>\\]",otype:st,fixity:Z,associativity:J,priority:2},"]":{input:[-1,"]"]},",":{input:[1,",",1],output:"<$.0>,<$.1>",otype:nt,fixity:W,associativity:q,priority:3},"?":{input:[1,"?",1,":",1],output:"(<$.0>?<$.1>:<$.2>)",otype:tt,fixity:W,associativity:J,priority:100},":":{input:[1,":",1]},"!":{input:["!",1],output:"!<$.0>",otype:at,fixity:H,associativity:J,priority:10},"~":{input:["~",1],output:"~<$.0>",otype:rt,fixity:H,associativity:J,priority:10},"^":{input:[1,"^",1],output:"Math.pow(<$.0>,<$.1>)",otype:rt,fixity:W,associativity:J,priority:11},"*":{input:[1,"*",1],output:"(<$.0>*<$.1>)",otype:rt,fixity:W,associativity:q,priority:20},"/":{input:[1,"/",1],output:"(<$.0>/<$.1>)",otype:rt,fixity:W,associativity:q,priority:20},"%":{input:[1,"%",1],output:"(<$.0>%<$.1>)",otype:rt,fixity:W,associativity:q,priority:20},"+":{polymorphic:[[function(t,n){return t.TOK&&!t.PREV_IS_OP&&t.DEDUCED_TYPE===n.T_ARY},{input:[1,"+",1],output:"Fn.ary_merge(<$.0>,<$.1>)",otype:st,fixity:W,associativity:q,priority:25}],[function(t,n){return t.TOK&&!t.PREV_IS_OP&&t.DEDUCED_TYPE===n.T_STR},{input:[1,"+",1],output:"(<$.0>+String(<$.1>))",otype:ot,fixity:W,associativity:q,priority:25}],[function(t,n){return t.TOK&&!t.PREV_IS_OP},{input:[1,"+",1],output:"(<$.0>+<$.1>)",otype:rt,fixity:W,associativity:q,priority:25}],[function(t,n){return!t.TOK||t.PREV_IS_OP},{input:["+",1],output:"<$.0>",otype:rt,fixity:H,associativity:J,priority:4}]]},"-":{polymorphic:[[function(t,n){return t.TOK&&!t.PREV_IS_OP},{input:[1,"-",1],output:"(<$.0>-<$.1>)",otype:rt,fixity:W,associativity:q,priority:25}],[function(t,n){return!t.TOK||t.PREV_IS_OP},{input:["-",1],output:"(-<$.0>)",otype:rt,fixity:H,associativity:J,priority:4}]]},">>":{input:[1,">>",1],output:"(<$.0>\\>\\><$.1>)",otype:rt,fixity:W,associativity:q,priority:30},"<<":{input:[1,"<<",1],output:"(<$.0>\\<\\<<$.1>)",otype:rt,fixity:W,associativity:q,priority:30},">":{input:[1,">",1],output:"(<$.0>\\><$.1>)",otype:at,fixity:W,associativity:q,priority:35},"<":{input:[1,"<",1],output:"(<$.0>\\<<$.1>)",otype:at,fixity:W,associativity:q,priority:35},">=":{input:[1,">=",1],output:"(<$.0>\\>=<$.1>)",otype:at,fixity:W,associativity:q,priority:35},"<=":{input:[1,"<=",1],output:"(<$.0>\\<=<$.1>)",otype:at,fixity:W,associativity:q,priority:35},"==":{polymorphic:[[function(t,n){return t.DEDUCED_TYPE===n.T_ARY},{input:[1,"==",1],output:"Fn.ary_eq(<$.0>,<$.1>)",otype:at,fixity:W,associativity:q,priority:40}],[function(t,n){return!0},{input:[1,"==",1],output:"(<$.0>==<$.1>)",otype:at,fixity:W,associativity:q,priority:40}]]},"!=":{input:[1,"!=",1],output:"(<$.0>!=<$.1>)",otype:at,fixity:W,associativity:q,priority:40},is:{input:[1,"is",1],output:"(<$.0>===<$.1>)",otype:at,fixity:W,associativity:q,priority:40},matches:{input:[1,"matches",1],output:"Fn.match(<$.1>,<$.0>)",otype:at,fixity:W,associativity:B,priority:40},in:{input:[1,"in",1],output:"Fn.contains(<$.1>,<$.0>)",otype:at,fixity:W,associativity:B,priority:40},"&":{input:[1,"&",1],output:"(<$.0>&<$.1>)",otype:rt,fixity:W,associativity:q,priority:45},"|":{input:[1,"|",1],output:"(<$.0>|<$.1>)",otype:rt,fixity:W,associativity:q,priority:46},"&&":{input:[1,"&&",1],output:"(<$.0>&&<$.1>)",otype:at,fixity:W,associativity:q,priority:47},"||":{input:[1,"||",1],output:"(<$.0>||<$.1>)",otype:at,fixity:W,associativity:q,priority:48},or:$("||"),and:$("&&"),not:$("!")},functions:{min:{input:"min",output:"Math.min(<$.0>)",otype:rt},max:{input:"max",output:"Math.max(<$.0>)",otype:rt},pow:{input:"pow",output:"Math.pow(<$.0>)",otype:rt},sqrt:{input:"sqrt",output:"Math.sqrt(<$.0>)",otype:rt},len:{input:"len",output:"Fn.len(<$.0>)",otype:rt},int:{input:"int",output:"parseInt(<$.0>)",otype:rt},float:{input:"float",output:"parseFloat(<$.0>)",otype:rt},str:{input:"str",output:"String(<$.0>)",otype:ot},clamp:{input:"clamp",output:"Fn.clamp(<$.0>)",otype:rt},sum:{input:"sum",output:"Fn.sum(<$.0>)",otype:rt},avg:{input:"avg",output:"Fn.avg(<$.0>)",otype:rt},time:{input:"avg",output:"Fn.time()",otype:rt,arity:0},date:{input:"date",output:"Fn.date(<$.0>)",otype:ot}},runtime:{clamp:function(t,n,e){return n>e?t>n?n:t<e?e:t:t>e?e:t<n?n:t},len:function(t){return t?l(t)||g(t)?t.length:v(t)?M(t).length:1:0},sum:function(){var t,n,e=arguments,i=0;if(e[0]&&l(e[0])&&(e=e[0]),(n=e.length)>0)for(t=0;t<n;t++)i+=e[t];return i},avg:function(){var t,n,e=arguments,i=0;if(e[0]&&l(e[0])&&(e=e[0]),(n=e.length)>0){for(t=0;t<n;t++)i+=e[t];i/=n}return i},ary_eq:function(t,n){var e,i=t.length;if(i!==n.length)return!1;for(e=0;e<i;e++)if(t[e]!=n[e])return!1;return!0},ary_merge:function(t,n){return[].concat(t).concat(n)},match:function(t,n){return n.test(t)},contains:function(t,n){return l(t)||g(t)?-1<t.indexOf(n):F.call(t,n)},time:m,date:b}})))},O.init(),O});
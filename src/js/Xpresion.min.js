/**
*
*   Xpresion
*   Simple eXpression parser engine with variables and custom functions support for PHP, Python, Node.js and Browser
*   @version: 1.0.0
*
*   https://github.com/foo123/Xpresion
*
**/
!function(t,n,e){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(t.$deps=t.$deps||{})&&(t.EXPORTED_SYMBOLS=[n])&&(t[n]=t.$deps[n]=e.call(t)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(t)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System.import?System.register(n,[],function(i){i(n,e.call(t))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(t)}):n in t||(t[n]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[n]})}("undefined"!=typeof self?self:this,"Xpresion",function(t){"use strict";function n(t,n){return t&&A.call(t,n)?1:0}function e(t,n,e,i){var l=String(t);if(e=e||"0",i)for(;l.length<n;)l+=e;else for(;l.length<n;)l=e+l;return l}function i(){return i.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(i.GUID.toString(16),4)}function l(t){return t instanceof Array||"[object Array]"===C.call(t)}function r(t,n,e){for(var i,l="";n<e&&(" "===(i=t[z](n))||"\r"===i||"\t"===i||"\v"===i||"\0"===i);)l+=i,n+=1;return l}function o(t,n){var e,i,l,r=t.length;if(r&&n.length)for(e="",l=0;l<r;l++)e+=i=t[z](l),"\n"===i&&(e+=n);else e=t;return e}function u(t,n,e,i){var l,r,o,u,a=0;if(n)for(l=t,r=n.length,o=0,a=1;o<r;){if(u=n[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&e)for(l=t,r=e.length,o=0,a=1;o<r;){if(u=e[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&null!=i&&i!==t){if(n)for(l=i,r=n.length,o=0,a=1;o<r;){if(u=n[o++],null==l||null==l[u]){a=0;break}l=l[u]}if(!a&&e)for(l=i,r=e.length,o=0,a=1;o<r;){if(u=e[o++],null==l||null==l[u]){a=0;break}l=l[u]}}return a?l:null}function a(t,n){this.prev=t||null,this.value=n||null}function s(t,n){n&&(n.next=this),this.node=t||null,this.prev=n||null,this.next=null}function p(t,n,e,i,r,o,a){var s,p,f,y,h,d,g,v,m=null,_="";if(-1===n.type){if((s=n.opt_args)&&s.value[5])for(;s;){if(p=s.value,f=u(t,p[1],[String(p[0])],p[6]?null:a),null===m&&n.name===p[0]&&(m=f),0===p[2]&&null==f||1===p[2]&&null!=f)return"";s=s.prev}}else m=u(t,n.key,[String(n.name)],n.loc?null:a);if(y=l(m),v=y?m.length:-1,y&&v>n.start)for(h=n.start,d=-1===n.end?v-1:Math.min(n.end,v-1),g=h;g<=d;g++)_+=c(t,n.tpl,e,i,g,o,a);else y||n.start!==n.end||(_=c(t,n.tpl,e,i,null,o,a));return _}function f(t,e,i,r,a,s,f){var c,h,d,g,v="";return e.stpl&&(n(i,e.stpl)||n(y.subGlobal,e.stpl)||n(r,e.stpl)||n(r,"*")||n(y.fnGlobal,e.stpl)||n(y.fnGlobal,"*"))?(c=u(t,e.key,[String(e.name)],e.loc?null:f),n(i,e.stpl)||n(y.subGlobal,e.stpl)?(null==a||0===a&&e.start===e.end&&e.opt||!l(c)||(c=a<c.length?c[a]:null),null==c&&null!==e.dval?v=e.dval:(d=n(i,e.stpl)?i[e.stpl].node:y.subGlobal[e.stpl].node,h={},null!=c&&(l(c)?h[d.name]=c:h=c),v=p(h,d,i,r,null,e.algn?s:"",null==f?t:f))):(g=null,n(r,e.stpl)?g=r[e.stpl]:n(r,"*")?g=r["*"]:n(y.fnGlobal,e.stpl)?g=y.fnGlobal[e.stpl]:y.fnGlobal["*"]&&(g=y.fnGlobal["*"]),l(c)&&(c=(a=null!=a?a:e.start)<c.length?c[a]:null),v=null==(c="function"==typeof g?g(c,{symbol:e,index:a,currentArguments:t,originalArguments:f,alignment:s}):String(g))&&null!==e.dval?e.dval:String(c),e.algn&&(v=o(v,s)))):e.opt&&null!==e.dval?v=e.dval:(l(c=u(t,e.key,[String(e.name)],e.loc?null:f))&&(c=(a=null!=a?a:e.start)<c.length?c[a]:null),v=null==c&&null!==e.dval?e.dval:String(c),e.algn&&(v=o(v,s))),v}function c(t,n,e,i,l,r,o){for(var u,a=r=r||"",s="";n;)-1===(u=n.node.type)?s+=p(t,n.node,e,i,l,n.node.algn?a:r,o):1===u?s+=f(t,n.node,e,i,l,n.node.algn?a:r,o):0===u?(a+=n.node.algn,s+=n.node.val):100===u&&(a=r,s+="\n"+r),n=n.next;return s}function y(t,n,e){var i=this;if(!(i instanceof y))return new y(t,n,e);i.id=null,i.tpl=null,i.fn={},i._args=[t||"",n||y.defaultDelimiters,e||!1]}function h(t,n){return new Function(t,n)}function d(t,n){return new RegExp(t,n||"")}function g(t){return t instanceof String||"[object String]"===C.call(t)}function v(t){return"[object Object]"===C.call(t)}function m(t,n,e){var i=t.toString(),l=n-i.length;return l>0?new Array(l+1).join(e||" ")+i:i}function _(){return I((new Date).getTime()/1e3)}function b(t,n){if(!arguments.length)return"";var e,i,l,r,o,u,a=V,s={},p=(o=n instanceof Date?new Date(n):"number"==typeof n?new Date(1e3*n):new Date).getTimezoneOffset(),f=U(p),c=o.getMonth();for(s.G=o.getHours(),s.j=o.getDate(),u=s.j%10,s.n=c+1,s.Y=o.getFullYear(),s.w=o.getDay(),s.N=s.w||7,s.d=m(s.j,2,"0"),s.D=a.day_short[s.w],s.l=a.day[s.w],s.S=a.ordinal.ord[s.j]?a.ordinal.ord[s.j]:a.ordinal.ord[u]?a.ordinal.ord[u]:a.ordinal.nth,s.z=Y((new Date(s.Y,c,s.j)-new Date(s.Y,0,1))/864e5),s.W=m(1+Y((new Date(s.Y,c,s.j-s.N+3)-new Date(s.Y,0,4))/864e5/7),2,"0"),s.F=a.month[c],s.m=m(s.n,2,"0"),s.M=a.month_short[c],s.t=new Date(s.Y,c+1,0).getDate(),s.L=s.Y%4==0&s.Y%100!=0|s.Y%400==0,s.o=s.Y+(11===c&&s.W<9?1:0===c&&s.W>9?-1:0),s.y=s.Y.toString().slice(-2),s.a=s.G>11?a.meridian.pm:a.meridian.am,s.A=s.G>11?a.meridian.PM:a.meridian.AM,s.B=m(I((3600*o.getUTCHours()+60*o.getUTCMinutes()+o.getUTCSeconds()+3600)/86.4)%1e3,3,"0"),s.g=s.G%12||12,s.h=m(s.g,2,"0"),s.H=m(s.G,2,"0"),s.i=m(o.getMinutes(),2,"0"),s.s=m(o.getSeconds(),2,"0"),s.u=m(1e3*o.getMilliseconds(),6,"0"),s.e="",s.I=new Date(s.Y,0)-Date.UTC(s.Y,0)!=new Date(s.Y,6)-Date.UTC(s.Y,6)?1:0,s.O=(p>0?"-":"+")+m(100*I(f/60)+f%60,4,"0"),s.P=s.O.substr(0,3)+":"+s.O.substr(3,2),s.T="UTC",s.Z=60*-p,s.U=o/1e3|0,s.c=[s.Y,"-",s.m,"-",s.d,"\\",s.T,s.H,":",s.i,":",s.s,s.P].join(""),s.r=[s.D,", ",s.d," ",s.M," ",s.Y," ",s.H,":",s.i,":",s.s," ",s.O].join(""),e="",l=0,r=t.length;l<r;l++)i=t.charAt(l),e+=A.call(s,i)?s[i]:i;return e}function S(){return null}function T(t,n,e){return h("Fn,Cache,Xpresion",["return function evaluator(Var){",'    "use strict";',"    return "+t+";","};"].join("\n"))(n,e,$)}function E(t,n,e){for(var i,l="",r=!1,o=!1,u=!1,a=0,s=n+a,p=!0;s<e&&p;)a+=1,"i"!=(i=t.charAt(s++))||r||(l+="i",r=!0),"m"!=i||u||(l+="m",u=!0),"g"!=i||o||(l+="g",o=!0),(a>=3||!r&&!o&&!u)&&(p=!1);return l}function O(t){var n=this;if(!(n instanceof O))return new O(t);n.RE={},n.BLOCKS={},n.RESERVED={},n.OPERATORS={},n.FUNCTIONS={},n.FN={INF:1/0,NAN:NaN},"object"==typeof t&&(t.re&&n.defRE(t.re),t.blocks&&n.defBlock(t.blocks),t.reserved&&n.defReserved(t.reserved),t.operators&&n.defOp(t.operators),t.functions&&n.defFunc(t.functions),t.runtime&&n.defRuntimeFunc(t.runtime))}function $(t,n){var e=this;if(!(e instanceof $))return new $(t,n);n&&n instanceof O||(n=$.defaultConfiguration()),e.source=String(null==t?"":t),e.dummy_evaluator=S,$.parse(e,n)}function x(t){if(!(this instanceof x))return new x(t);this.alias=t}function R(t,n,e,i,l){var r=this;if(!(r instanceof R))return new R(t,n,e,i,l);r.type=t,r.arity=n,r.node=e,r.children=i||null,r.pos=l||0}function w(t,n,e,i){var l=this;if(!(l instanceof w))return new w(t,n,e,i);l.type=t,l.input=n,l.output=e,l.value=i||null,l.priority=1e3,l.parity=0,l.arity=0,l.arity_min=0,l.arity_max=0,l.associativity=q,l.fixity=Z,l.parenthesize=!1,l.revert=!1}function D(t,n,e,i,l,r,o){var u=this;if(!(u instanceof D))return new D(t,n,e,i,l,r,o);t=null==t?"":t,n=null==n?"":n;var a=D.parse_definition(t);u.type=a[0],u.opdef=a[1],u.parts=a[2],n instanceof y||(n=new y(String(n))),w.call(u,u.type,u.parts[0],n),u.fixity=null!=i?i:W,u.associativity=null!=l?l:q,u.priority=null!=r?r:1e3,u.arity=a[3],u.arity_min=a[4],u.arity_max=a[5],u.otype=null!=e?e:nt,u.ofixity=null!=o?o:u.fixity,u.parenthesize=!1,u.revert=!1,u.morphes=null}function P(t,n,e,i,l,r,o){var u=this;if(!(u instanceof P))return new P(t,n,e,i,l,r,o);t=null==t?"":t,n=null==n?"":n,D.call(u,g(t)?[t,null!=l?l:1]:t,n,null!=e?e:nt,W,null!=r?r:H,null!=i?i:1,null!=o?o:W),u.type=ht}var N,F="prototype",A=Object[F].hasOwnProperty,C=Object[F].toString,M=JSON.stringify,j=Object.keys,k=Object.create,I=Math.floor,Y=Math.round,U=Math.abs,G=Math.max,V={meridian:{am:"am",pm:"pm",AM:"AM",PM:"PM"},ordinal:{ord:{1:"st",2:"nd",3:"rd"},nth:"th"},timezone:["UTC","EST","MDT"],timezone_short:["UTC","EST","MDT"],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},z="charAt",L=/^\s+|\s+$/g,K=String[F].trim?function(t){return t.trim()}:function(t){return t.replace(L,"")},B=!1;i.GUID=0,y.VERSION="3.0.0",y.defaultDelimiters=["<",">","[","]"],y.fnGlobal={},y.subGlobal={},y.guid=i,y.multisplit=function(t,e,l){var o,u,p,f,c,y,h,d,g,v,m,_,b,S,T,E,O,$,x,R,w,D,P,N,F,A,C=e[0],M=e[1],j=e[2],k=e[3],I=C.length,Y=M.length,U=j.length,G=k.length,V="#"+k,L=null,B=0,X=0,q=0,J=0,H=t.length,W=[C,I,M,Y],Z=[j,U,k,G],Q=[null,0,null,0,null,0,null,0];for(l=!0===l,x={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},w=g=new s({type:0,val:"",algn:""}),D=null,R=null,T={},O=null,E={},$=null,W[1]<W[3]&&(m=W[0],W[2]=W[0],W[0]=m,_=W[1],W[3]=W[1],W[1]=_),Z[1]<Z[3]&&(m=Z[0],Z[2]=Z[0],Z[0]=m,_=Z[1],Z[3]=Z[1],Z[1]=_),u=0,p=0,_=0;4>u&&4>p;)W[u+1]<Z[p+1]?(Q[_]=Z[p],Q[_+1]=Z[p+1],p+=2):(Q[_]=W[u],Q[_+1]=W[u+1],u+=2),_+=2;for(;4>u;)Q[_]=W[u],Q[_+1]=W[u+1],u+=2,_+=2;for(;4>p;)Q[_]=Z[p],Q[_+1]=Z[p+1],p+=2,_+=2;for(h=null,m="",_=0;_<H;)if("\\"!==(d=t[z](_)))if(A=null,Q[0]===t.substr(_,Q[1])?A=Q[0]:Q[2]===t.substr(_,Q[3])?A=Q[2]:Q[4]===t.substr(_,Q[5])?A=Q[4]:Q[6]===t.substr(_,Q[7])&&(A=Q[6]),C===A)_+=I,m.length&&(0===g.node.type?g.node.val+=m:g=new s({type:0,val:m,algn:""},g)),m="";else if(M===A){if(_+=Y,c=m,m="",-1<(y=c.indexOf("|"))?(L=c.slice(y+1),c=c.slice(0,y)):L=null,"?"===(d=l?_<H?t[z](_):"":c[z](0))||"*"===d)X=1,"*"===d?(u=1,p=-1):(u=0,p=0),l?(_+=1)<H&&"!"===t[z](_)?(B=1,_+=1):B=0:"!"===c[z](1)?(B=1,c=c.slice(2)):(B=0,c=c.slice(1));else if("{"===d){if(l){for(m="",b=_+1,S=H;b<S&&"}"!==t[z](b);)m+=t[z](b++);_=b+1}else{for(m="",b=1,S=c.length;b<S&&"}"!==c[z](b);)m+=c[z](b++);c=c.slice(b+1)}(m=m.split(",")).length>1?(u=(u=K(m[0])).length?0|+u:0,p=(p=K(m[1])).length?0|+p:-1,X=1):(p=u=(u=K(m[0])).length?0|+u:0,X=0),m="",B=0}else X=0,B=0,u=0,p=0;if(B&&null===L&&(L=""),"@"===(d=c[z](0))?(q=1,c=c.slice(1)):q=0,"."===(d=c[z](0))?(J=1,c=c.slice(1)):J=0,f=-1<c.indexOf(":")?c.split(":"):[c,null],c=f[0],f=f[1],o=-1<c.indexOf(".")?c.split("."):null,O&&!n(E,O)&&(E[O]={}),":="+j===t.substr(_,2+U)&&(_+=2,$=f=f&&f.length?f:"grtpl--"+i(),O&&c.length&&(E[O][c]=f)),!c.length)continue;null==f&&O&&n(E,O)&&n(E[O],c)&&(f=E[O][c]),X&&!x.opt?(x.name=c,x.key=o,x.stpl=f,x.dval=L,x.opt=X,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p,R=new a(null,[c,o,B,u,p,X,J])):X?(u!==p&&x.start===x.end&&(x.name=c,x.key=o,x.stpl=f,x.dval=L,x.opt=X,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p),R=new a(R,[c,o,B,u,p,X,J])):X||null!==x.name||(x.name=c,x.key=o,x.stpl=f,x.dval=L,x.opt=0,x.neg=B,x.algn=q,x.loc=J,x.start=u,x.end=p,R=new a(null,[c,o,B,u,p,0,J])),0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:1,name:c,key:o,stpl:f,dval:L,opt:X,algn:q,loc:J,start:u,end:p},g)}else if(j===A){if(_+=U,m.length&&(0===g.node.type?g.node.val+=m:g=new s({type:0,val:m,algn:""},g)),m="","#"===t[z](_)){for(b=_+1,S=H;b<S&&V!==t.substr(b,G+1);)m+=t[z](b++);_=b+G+1,0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:-100,val:m},g),m="";continue}h=new a(h,[g,D,x,R,O,$]),$&&(O=$),$=null,x={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},R=null,D=g=new s({type:0,val:"",algn:""})}else k===A?(_+=G,v=g,P=D,N=x,F=R,h?(g=h.value[0],D=h.value[1],x=h.value[2],R=h.value[3],O=h.value[4],$=h.value[5],h=h.prev):g=null,m.length&&(0===v.node.type?v.node.val+=m:v=new s({type:0,val:m,algn:""},v)),m="",$?(T[$]=new s({type:2,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:null,tpl:P}),$=null):(0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:-1,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:F,tpl:P},g))):"\n"===(d=t[z](_++))?(m.length&&(0===g.node.type?g.node.val+=m:g=new s({type:0,val:m,algn:""},g)),m="",0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),g=new s({type:100,val:"\n"},g)):m+=d;else m+=_+1<H?t[z](_+1):"",_+=2;return m.length&&(0===g.node.type?g.node.val+=m:g=new s({type:0,val:m,algn:""},g)),0===g.node.type&&(g.node.algn=r(g.node.val,0,g.node.val.length)),[w,T]},y.align=o,y.main=c,y[F]={constructor:y,id:null,tpl:null,fn:null,_args:null,dispose:function(){var t=this;return t.id=null,t.tpl=null,t.fn=null,t._args=null,t},parse:function(){var t=this;return null===t.tpl&&null!==t._args&&(t.tpl=y.multisplit(t._args[0],t._args[1],t._args[2]),t._args=null),t},render:function(t){var n=this;return null===n.tpl&&n.parse(),y.main(null==t?{}:t,n.tpl[0],n.tpl[1],n.fn)}},O[F]={constructor:O,RE:null,BLOCKS:null,RESERVED:null,OPERATORS:null,FUNCTIONS:null,FN:null,dispose:function(){var t=this;return t.RE=null,t.BLOCKS=null,t.RESERVED=null,t.OPERATORS=null,t.FUNCTIONS=null,t.FN=null,t},defRE:function(t){if("object"==typeof t)for(var n in t)A.call(t,n)&&(this.RE[n]=t[n]);return this},defBlock:function(t){if("object"==typeof t)for(var n in t)A.call(t,n)&&(this.BLOCKS[n]=t[n]);return this},defReserved:function(t){if("object"==typeof t)for(var n in t)A.call(t,n)&&(this.RESERVED[n]=t[n]);return this},defOp:function(t){if("object"==typeof t){var n,e;for(n in t)A.call(t,n)&&t[n]&&((e=t[n])instanceof x||e instanceof D?this.OPERATORS[n]=e:e.polymorphic?this.OPERATORS[n]=D().Polymorphic(e.polymorphic.map(function(t){var n,e;return v(t)?(n=t.check,e=t.op):(n=t[0],e=t[1]),e=e instanceof D?e:new D(e.input,e.output,e.otype,e.fixity,e.associativity,e.priority,e.ofixity),[n,e]})):this.OPERATORS[n]=new D(e.input,e.output,e.otype,e.fixity,e.associativity,e.priority,e.ofixity))}return this},defFunc:function(t){if("object"==typeof t){var n,e;for(n in t)A.call(t,n)&&t[n]&&(e=t[n],this.FUNCTIONS[n]=e instanceof x||e instanceof P?e:new P(e.input,e.output,e.otype,e.priority,e.arity,e.associativity,e.ofixity))}return this},defRuntimeFunc:function(t){if("object"==typeof t)for(var n in t)A.call(t,n)&&(this.FN[n]=t[n]);return this}},$.VERSION="1.0.0",$.Configuration=O,$.CONF=null,$.defaultConfiguration=function(t){return arguments.length&&($.CONF=t),$.CONF};$.COMMA=",",$.LPAREN="(",$.RPAREN=")";var X=$.NONE=0,q=$.DEFAULT=1,J=$.LEFT=-2,H=$.RIGHT=2,W=$.PREFIX=2,Z=$.INFIX=4,Q=$.POSTFIX=8,tt=$.T_DUM=0,nt=$.T_MIX=1,et=$.T_DFT=nt,it=$.T_IDE=16,lt=$.T_VAR=17,rt=$.T_LIT=32,ot=$.T_NUM=33,ut=$.T_STR=34,at=$.T_REX=35,st=$.T_BOL=36,pt=($.T_DTM=37,$.T_ARY=38),ft=$.T_OP=128,ct=$.T_N_OP=129,yt=$.T_POLY_OP=130,ht=$.T_FUN=131,dt=$.T_EMPTY=1024;return $.Tpl=y,$.Alias=x,x.get_entry=function(t,n){if(n&&t&&A.call(t,n)){for(var e=t[n];e instanceof x&&A.call(t,e.alias);){if(n=e.alias,e===t[n])return!1;e=t[n]}return e}return!1},$.Node=R,R[F]={constructor:R,type:null,arity:null,node:null,children:null,pos:null,op_parts:null,op_def:null,op_index:null,op_next:function(t,n,e,i){var l=this,r=0,o=0===l.op_parts.indexOf(t.input);return o&&0===l.op_def[0][0]&&(!1===(r=D.match_args(l.op_def[0][2],n-1,e,i))?o=!1:(l.arity=r,l.op_def.shift())),o&&(l.op_def.shift(),l.op_parts.shift()),o},op_complete:function(){return!this.op_parts.length},dispose:function(){var t,n,e=this,i=e.children;if(i&&(t=i.length))for(n=0;n<t;n++)i[n]&&i[n].dispose();return e.type=null,e.arity=null,e.pos=null,e.node=null,e.op_parts=null,e.op_def=null,e.op_index=null,i=e.children=null,e},toString:function(){var t,n=[],e=this.node,i=this.children?this.children:[],l=i.length;for(t=0;t<l;t++)n.push(i[t].toString());return["Node("+e.type+","+e.arity+"): "+(e.parts?e.parts.join(" "):e.input),"Childs: [",""+n.join("\n"),"]"].join("\n")+"\n"}},R.DFT=function(t,n,e){e=!1!==e,n=n||$.render;for(var i,l,r,o,u=[t],a=[];u.length;)(i=u[0]).children&&i.children.length?(u=i.children.concat(u),i.children=null):(u.shift(),r=(l=i.node).arity,ft&l.type&&0===r?r=1:r>a.length&&l.arity_min<=l.arity&&(r=l.arity_min),o=n(l,r?a.splice(a.length-r,r):[]),a.push(o),e&&i.dispose());return u=null,a[0]},$.reduce=function(t,n,e,i,l,r){var o,u,a,s,p,f,c,y=null,h=0;if(i)if(s=i,yt===s.type&&(s=s.morph([l,t,n])),ct===s.type){if(!1===(f=s.validate(l,n,t))[0])return r.err=!0,r.msg=f[1],!1;(a=s.node(null,l,n,t)).arity=f[0],e.unshift(a),n.unshift(a)}else{if(e.length&&(h=(y=e[0]).op_index),y&&y.op_next(s,l,n,t)){for(;n.length>h;)c=(u=(o=n.shift()).node).arity,ft&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a);if(!y.op_complete())return;e.shift(),n.shift(),s=y.node,y.dispose(),h=e.length?e[0].op_index:0}else if(!1===(f=s.validate(l,n,t))[0])return r.err=!0,r.msg=f[1],!1;if(p=s.fixity,Q===p)(c=s.arity)>t.length&&s.arity_min<=t.length&&(c=s.arity_min),a=s.node(c?t.splice(t.length-c,c):[],l),t.push(a);else if(W===p)n.unshift(R(s.otype,s.arity,s,null,l)),ft&s.type&&0===s.arity&&t.push(N.node(null,l+1));else{for(;n.length>h;){if(o=n.shift(),!((u=o.node).priority<s.priority||u.priority===s.priority&&(u.associativity<s.associativity||u.associativity===s.associativity&&u.associativity<0))){n.unshift(o);break}c=u.arity,ft&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a)}n.unshift(R(s.otype,s.arity,s,null,l))}}else for(;n.length;)c=(u=(o=n.shift()).node).arity,ft&u.type&&0===c?c=1:c>t.length&&u.arity_min<=u.arity&&(c=u.arity_min),a=u.node(c?t.splice(t.length-c,c):[],o.pos),t.push(a)},$.parse_delimited_block=function(t,n,e,i,l){5>arguments.length&&(l=!0);var r=i,o=!1,u="";for(l=!1!==l,n+=1;n<e&&(u=t.charAt(n++),r+=u,i!==u||o);)o=!!l&&(!o&&"\\"===u);return r},$.parse=function(t,n){var e,i,l,r,o,u,a,s,p,f,c,y,h,d,g,v,m=$.reduce,_=x.get_entry,b=!A.call(n.RE,"t_var"),S=0,T={err:!1,msg:""};for(i=(e=String(t.source)).length,u=0,t._cnt=0,t._symbol_table={},t._cache={},t.variables={},p=[],f=[],c=[],y=0,S=0;u<i;)if(r=e.charAt(u),(h=_(n.BLOCKS,r))&&!1!==(o=h.parse(e,u,i,r))&&(u+=o.length,"function"==typeof h.rest?(g=h.rest(e,u,i))||(g=""):g="",u+=g.length,!1!==(s=t.t_block(n,o,h.type,g))))y+=1,p.push(s.node(null,y));else if(l=e.slice(u),a=l.match(n.RE.t_spc))u+=a[0].length;else if((a=l.match(n.RE.t_num))&&!1!==(s=t.t_liter(n,a[1],ot)))y+=1,p.push(s.node(null,y)),u+=a[0].length;else{if(a=l.match(n.RE.t_ident)){if(!1!==(s=t.t_liter(n,a[1],it))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}if(!1!==(s=t.t_op(n,a[1]))){if(y+=1,m(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=a[0].length;continue}if(b&&!1!==(s=t.t_var(n,a[1]))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}}if(a=l.match(n.RE.t_special)){for(o=a[1],s=!1;o.length>0&&!1===(s=t.t_op(n,o));)o=o.slice(0,-1);if(!1!==s){if(y+=1,m(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=o.length;continue}}if(b||!(a=l.match(n.RE.t_var))||!1===(s=t.t_var(n,a[1]))){if(a=l.match(n.RE.t_nonspc)){if(!1!==(s=t.t_liter(n,a[1],rt))){y+=1,p.push(s.node(null,y)),u+=a[0].length;continue}if(!1!==(s=t.t_op(n,a[1]))){if(y+=1,m(p,f,c,s,y,T),T.err){S=1,v=T.msg;break}u+=a[0].length;continue}s=t.t_tok(n,a[1]),y+=1,p.push(s.node(null,y)),u+=a[0].length}}else y+=1,p.push(s.node(null,y)),u+=a[0].length}if(S||(m(p,f,c),(1!==p.length||f.length>0)&&(S=1,v="Parse Error, Mismatched Parentheses or Operators")),!S)try{d=t.compile(p[0],n)}catch(l){S=1,v="Compilation Error, "+l.toString()}if(c=null,f=null,p=null,t._symbol_table=null,S)throw d=null,t.variables=[],t._cnt=0,t._cache={},t.evaluatorString="",t.evaluator=t.dummy_evaluator,new Error("Xpresion Error: "+v+' at "'+e+'"');return t.variables=j(t.variables),t.evaluatorString=d[0],t.evaluator=d[1],t},$.render=function(t,n){return t.render(n)},$.GET=function(t,n){if(!n||!n.length)return t;for(var e,i=0,l=n.length,r=t;i<l&&(e=n[i++],r)&&null!=r[e];)r=r[e];return i===l?r:null},$.Tok=w,w.render=function(t,n){return t instanceof w?t.render(n||[]):String(t)},w[F]={constructor:w,type:null,input:null,output:null,value:null,priority:1e3,parity:0,arity:0,arity_min:0,arity_max:0,associativity:q,fixity:Z,parenthesize:!1,revert:!1,dispose:function(){var t=this;return t.type=null,t.input=null,t.output=null,t.value=null,t.priority=null,t.parity=null,t.arity=null,t.arity_min=null,t.arity_max=null,t.associativity=null,t.fixity=null,t.parenthesize=null,t.revert=null,t},setType:function(t){return this.type=t,this},setParenthesize:function(t){return this.parenthesize=!!t,this},setReverse:function(t){return this.revert=!!t,this},render:function(t){var n,e=this,i=e.output,l=e.parenthesize,r=l?$.LPAREN:"",o=l?$.RPAREN:"";return t||(t=[]),t.unshift(e.input),n=i instanceof y?i.render({$:t}):String(i),r+n+o},node:function(t,n){return R(this.type,this.arity,this,t||null,n||0)},toString:function(){return String(this.output)}},N=$.EMPTY_TOKEN=w(dt,"",""),$.Op=D,D.Condition=function(t){if(g(t[0]))try{t[0]=h("curr,Xpresion","return "+t[0]+";")}catch(n){t[0]=null}return["function"==typeof t[0]?t[0]:null,t[1]]},D.parse_definition=function(t){var n,e,i,l,r=[],o=[],u=0,a=0,s=0;for(i=0,l=(t=g(t)?[1,t,1]:[].concat(t)).length;i<l;i++)g(t[i])?(r.push(t[i]),o.push([1,i,t[i]])):(o.push([0,i,t[i]]),u+=n=U(t[i]),s+=n,a+=t[i]);return 1===r.length&&1===o.length?(o=[[0,0,1],[1,1,r[0]],[0,2,1]],a=s=u=2,e=ft):e=r.length>1?ct:ft,[e,o,r,u,G(0,a),s]},D.match_args=function(t,n,e,i){for(var l,r=i.length-1,o=0,u=U(t);(o<u||r>=0)&&(l=r>=0?i[r].pos:-10,n===l);)o++,n--,r--;return o>=u?u:t<=0&&0},D[F]=k(w[F]),D[F].otype=null,D[F].ofixity=null,D[F].opdef=null,D[F].parts=null,D[F].morphes=null,D[F].dispose=function(){var t=this;return t.otype=null,t.ofixity=null,t.opdef=null,t.parts=null,t.morphes=null,w[F].dispose.call(t),t},D[F].Polymorphic=function(t){var n=this;return n.type=yt,n.morphes=(t||[]).map(D.Condition),n},D[F].morph=function(t){var n,e,i=this.morphes,l=i.length,r=0,o=i[0][1],u=!1;for(t.length<7&&(t.push(!!t[1].length&&t[1][t[1].length-1]),t.push(!!t[2].length&&t[2][0]),t.push(!!t[4]&&t[4].pos+1===t[0]),t.push(t[4]?t[4].type:t[3]?t[3].type:0)),e={POS:t[0],TOKS:t[1],OPS:t[2],TOK:t[3],OP:t[4],PREV_IS_OP:t[5],DEDUCED_TYPE:t[6]};r<l;){if(n=i[r++],!0===Boolean(n[0](e,$))){n=n[1],u=!0;break}n[1].priority>=o.priority&&(o=n[1])}for(u||(n=o);yt===n.type;)n=n.morph(t);return n},D[F].render=function(t){t&&t.length||(t=["",""]);var n,e=this,i=e.otype,l=e.output,r=e.parenthesize,o=r?$.LPAREN:"",u=r?$.RPAREN:"",a=$.COMMA,s=e.ofixity;t.length;return n=l instanceof y?o+l.render({$:t})+u:Z===s?o+t.join(l)+u:Q===s?o+t.join(a)+u+l:l+o+t.join(a)+u,w(i,n,n)},D[F].validate=function(t,n,e){var i=this,l=i.opdef,r="",o=0;return 0===l[0][0]&&!1===(o=D.match_args(l[0][2],t-1,n,e))&&(r='Operator "'+i.input+'" expecting '+l[0][2]+" prior argument(s)"),[o,r]},D[F].node=function(t,n,e,i){t=t||[],n=n||0;var l,r=this,o=r.otype;return r.revert&&t.reverse(),tt===o&&t.length?o=t[0].type:t.length&&(t[0].type=o),l=new R(o,r.arity,r,t,n),ct===r.type&&arguments.length>2&&(l.op_parts=r.parts.slice(1),l.op_def=r.opdef.slice(0===r.opdef[0][0]?2:1),l.op_index=arguments[2].length+1),l},$.Func=P,P[F]=k(D[F]),$[F]={constructor:$,source:null,variables:null,evaluatorString:null,evaluator:null,_cnt:0,_cache:null,_symbol_table:null,dummy_evaluator:null,dispose:function(){var t=this;return t.dummy_evaluator=null,t.source=null,t.variables=null,t.evaluatorString=null,t.evaluator=null,t._cnt=null,t._symbol_table=null,t._cache=null,t},compile:function(t,n){var e=R.DFT(t,$.render,!0);return[e,T(e,n.FN,this._cache)]},evaluate:function(t){return 1>arguments.length&&(t={}),"function"==typeof this.evaluator?this.evaluator(t):null},debug:function(t){var n=this,e=["Expression: "+n.source,"Variables : ["+n.variables.join(",")+"]","Evaluator : "+n.evaluatorString];return arguments.length&&(e.push("Data      : "+M(t,null,4)),e.push("Result    : "+M(n.evaluate(t)))),e.join("\n")},toString:function(){return"[Xpresion source]: "+String(this.source)},t_liter:function(t,n,e){return ot===e?w(ot,n,n):x.get_entry(t.RESERVED,n.toLowerCase())},t_block:function(t,n,e,i){if(i=i||"",ut===e)return w(ut,n,n);if(at===e){var l,r,o="re_"+n+i;return A.call(this._symbol_table,o)?l=this._symbol_table[o]:(l="re_"+ ++this._cnt,r=n.slice(1,-1),this._cache[l]=d(r,i),this._symbol_table[o]=l),w(at,n,"Cache."+l)}return!1},t_var:function(t,n){var e,i=n.split("."),l=i[0];return A.call(this.variables,l)||(this.variables[l]=l),1<i.length?(e='["'+i.slice(1).join('","')+'"]',w(lt,l,'Xpresion.GET(Var["'+l+'"],'+e+")")):w(lt,l,'Var["'+l+'"]')},t_op:function(t,n){var e=!1;return!1===(e=x.get_entry(t.FUNCTIONS,n))&&(e=x.get_entry(t.OPERATORS,n)),e},t_tok:function(t,n){return w(nt,n,n)}},$.init=function(){B||(B=!0,$.defaultConfiguration(O({re:{t_spc:/^(\s+)/,t_nonspc:/^(\S+)/,t_special:/^([*.\\\-+\/\^\$\(\)\[\]|?<:>&~%!#@=_,;{}]+)/,t_num:/^(\d+(\.\d+)?)/,t_ident:/^([a-zA-Z_][a-zA-Z0-9_]*)\b/,t_var:/^\$([a-zA-Z0-9_][a-zA-Z0-9_.]*)\b/},blocks:{"'":{type:ut,parse:$.parse_delimited_block},'"':x("'"),"`":{type:at,parse:$.parse_delimited_block,rest:E}},reserved:{null:w(it,"null","null"),false:w(st,"false","false"),true:w(st,"true","true"),infinity:w(ot,"Infinity","Infinity"),nan:w(ot,"NaN","NaN"),none:x("null"),inf:x("infinity")},operators:{"(":{input:["(",-1,")"],output:"<$.0>",otype:tt,fixity:Q,associativity:H,priority:0},")":{input:[-1,")"]},"[":{input:["[",-1,"]"],output:"\\[<$.0>\\]",otype:pt,fixity:Q,associativity:H,priority:2},"]":{input:[-1,"]"]},",":{input:[1,",",1],output:"<$.0>,<$.1>",otype:et,fixity:Z,associativity:J,priority:3},"?":{input:[1,"?",1,":",1],output:"(<$.0>?<$.1>:<$.2>)",otype:st,fixity:Z,associativity:H,priority:100},":":{input:[1,":",1]},"!":{input:["!",1],output:"!<$.0>",otype:st,fixity:W,associativity:H,priority:10},"~":{input:["~",1],output:"~<$.0>",otype:ot,fixity:W,associativity:H,priority:10},"^":{input:[1,"^",1],output:"Math.pow(<$.0>,<$.1>)",otype:ot,fixity:Z,associativity:H,priority:11},"*":{input:[1,"*",1],output:"(<$.0>*<$.1>)",otype:ot,fixity:Z,associativity:J,priority:20},"/":{input:[1,"/",1],output:"(<$.0>/<$.1>)",otype:ot,fixity:Z,associativity:J,priority:20},"%":{input:[1,"%",1],output:"(<$.0>%<$.1>)",otype:ot,fixity:Z,associativity:J,priority:20},"+":{polymorphic:[[function(t,n){return t.TOK&&!t.PREV_IS_OP&&t.DEDUCED_TYPE===n.T_ARY},{input:[1,"+",1],output:"Fn.ary_merge(<$.0>,<$.1>)",otype:pt,fixity:Z,associativity:J,priority:25}],[function(t,n){return t.TOK&&!t.PREV_IS_OP&&t.DEDUCED_TYPE===n.T_STR},{input:[1,"+",1],output:"(<$.0>+String(<$.1>))",otype:ut,fixity:Z,associativity:J,priority:25}],[function(t,n){return t.TOK&&!t.PREV_IS_OP},{input:[1,"+",1],output:"(<$.0>+<$.1>)",otype:ot,fixity:Z,associativity:J,priority:25}],[function(t,n){return!t.TOK||t.PREV_IS_OP},{input:["+",1],output:"<$.0>",otype:ot,fixity:W,associativity:H,priority:4}]]},"-":{polymorphic:[[function(t,n){return t.TOK&&!t.PREV_IS_OP},{input:[1,"-",1],output:"(<$.0>-<$.1>)",otype:ot,fixity:Z,associativity:J,priority:25}],[function(t,n){return!t.TOK||t.PREV_IS_OP},{input:["-",1],output:"(-<$.0>)",otype:ot,fixity:W,associativity:H,priority:4}]]},">>":{input:[1,">>",1],output:"(<$.0>\\>\\><$.1>)",otype:ot,fixity:Z,associativity:J,priority:30},"<<":{input:[1,"<<",1],output:"(<$.0>\\<\\<<$.1>)",otype:ot,fixity:Z,associativity:J,priority:30},">":{input:[1,">",1],output:"(<$.0>\\><$.1>)",otype:st,fixity:Z,associativity:J,priority:35},"<":{input:[1,"<",1],output:"(<$.0>\\<<$.1>)",otype:st,fixity:Z,associativity:J,priority:35},">=":{input:[1,">=",1],output:"(<$.0>\\>=<$.1>)",otype:st,fixity:Z,associativity:J,priority:35},"<=":{input:[1,"<=",1],output:"(<$.0>\\<=<$.1>)",otype:st,fixity:Z,associativity:J,priority:35},"==":{polymorphic:[[function(t,n){return t.DEDUCED_TYPE===n.T_ARY},{input:[1,"==",1],output:"Fn.ary_eq(<$.0>,<$.1>)",otype:st,fixity:Z,associativity:J,priority:40}],[function(t,n){return!0},{input:[1,"==",1],output:"(<$.0>==<$.1>)",otype:st,fixity:Z,associativity:J,priority:40}]]},"!=":{input:[1,"!=",1],output:"(<$.0>!=<$.1>)",otype:st,fixity:Z,associativity:J,priority:40},is:{input:[1,"is",1],output:"(<$.0>===<$.1>)",otype:st,fixity:Z,associativity:J,priority:40},matches:{input:[1,"matches",1],output:"Fn.match(<$.1>,<$.0>)",otype:st,fixity:Z,associativity:X,priority:40},in:{input:[1,"in",1],output:"Fn.contains(<$.1>,<$.0>)",otype:st,fixity:Z,associativity:X,priority:40},"&":{input:[1,"&",1],output:"(<$.0>&<$.1>)",otype:ot,fixity:Z,associativity:J,priority:45},"|":{input:[1,"|",1],output:"(<$.0>|<$.1>)",otype:ot,fixity:Z,associativity:J,priority:46},"&&":{input:[1,"&&",1],output:"(<$.0>&&<$.1>)",otype:st,fixity:Z,associativity:J,priority:47},"||":{input:[1,"||",1],output:"(<$.0>||<$.1>)",otype:st,fixity:Z,associativity:J,priority:48},or:x("||"),and:x("&&"),not:x("!")},functions:{min:{input:"min",output:"Math.min(<$.0>)",otype:ot},max:{input:"max",output:"Math.max(<$.0>)",otype:ot},pow:{input:"pow",output:"Math.pow(<$.0>)",otype:ot},sqrt:{input:"sqrt",output:"Math.sqrt(<$.0>)",otype:ot},len:{input:"len",output:"Fn.len(<$.0>)",otype:ot},int:{input:"int",output:"parseInt(<$.0>)",otype:ot},str:{input:"str",output:"String(<$.0>)",otype:ut},clamp:{input:"clamp",output:"Fn.clamp(<$.0>)",otype:ot},sum:{input:"sum",output:"Fn.sum(<$.0>)",otype:ot},avg:{input:"avg",output:"Fn.avg(<$.0>)",otype:ot},time:{input:"avg",output:"Fn.time()",otype:ot,arity:0},date:{input:"date",output:"Fn.date(<$.0>)",otype:ut}},runtime:{clamp:function(t,n,e){return n>e?t>n?n:t<e?e:t:t>e?e:t<n?n:t},len:function(t){return t?l(t)||g(t)?t.length:v(t)?j(t).length:1:0},sum:function(){var t,n,e=arguments,i=0;if(e[0]&&l(e[0])&&(e=e[0]),(n=e.length)>0)for(t=0;t<n;t++)i+=e[t];return i},avg:function(){var t,n,e=arguments,i=0;if(e[0]&&l(e[0])&&(e=e[0]),(n=e.length)>0){for(t=0;t<n;t++)i+=e[t];i/=n}return i},ary_eq:function(t,n){var e,i=t.length;if(i!==n.length)return!1;for(e=0;e<i;e++)if(t[e]!=n[e])return!1;return!0},ary_merge:function(t,n){return[].concat(t).concat(n)},match:function(t,n){return n.test(t)},contains:function(t,n){return l(t)||g(t)?-1<t.indexOf(n):A.call(t,n)},time:_,date:b}})))},$.init(),$});